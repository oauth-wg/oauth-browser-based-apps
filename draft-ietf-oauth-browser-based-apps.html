<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OAuth 2.0 for Browser-Based Applications</title>
<meta content="Aaron Parecki" name="author">
<meta content="David Waite" name="author">
<meta content="Philippe De Ryck" name="author">
<meta content="
       This specification details the threats, attack consequences, security considerations and best practices that must be
taken into account when developing browser-based applications that use OAuth 2.0. 
    " name="description">
<meta content="xml2rfc 3.21.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-oauth-browser-based-apps-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.21.0
    Python 3.11.9
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.2.1
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-oauth-browser-based-apps.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OAuth 2.0 for Browser-Based Applications</td>
<td class="right">May 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Parecki, et al.</td>
<td class="center">Expires 7 November 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Web Authorization Protocol</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-oauth-browser-based-apps-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-05-06" class="published">6 May 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Best Current Practice</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-11-07">7 November 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Parecki</div>
<div class="org">Okta</div>
</div>
<div class="author">
      <div class="author-name">D. Waite</div>
<div class="org">Ping Identity</div>
</div>
<div class="author">
      <div class="author-name">P. De Ryck</div>
<div class="org">Pragmatic Web Security</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OAuth 2.0 for Browser-Based Applications</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This specification details the threats, attack consequences, security considerations and best practices that must be
taken into account when developing browser-based applications that use OAuth 2.0.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Web Authorization Protocol Working Group mailing list (oauth@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/oauth/">https://mailarchive.ietf.org/arch/browse/oauth/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/oauth-wg/oauth-browser-based-apps">https://github.com/oauth-wg/oauth-browser-based-apps</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 7 November 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-notational-conventions" class="internal xref">Notational Conventions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-history-of-oauth-20-in-brow" class="internal xref">History of OAuth 2.0 in Browser-Based Applications</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-the-threat-of-malicious-jav" class="internal xref">The Threat of Malicious JavaScript</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-malicious-javascript-scenar" class="internal xref">Malicious JavaScript Scenarios</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-single-execution-token-thef" class="internal xref">Single-Execution Token Theft</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-persistent-token-theft" class="internal xref">Persistent Token Theft</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="auto internal xref">5.1.3</a>.  <a href="#name-acquisition-and-extraction-" class="internal xref">Acquisition and Extraction of New Tokens</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.4">
                    <p id="section-toc.1-1.5.2.1.2.4.1"><a href="#section-5.1.4" class="auto internal xref">5.1.4</a>.  <a href="#name-proxying-requests-via-the-u" class="internal xref">Proxying Requests via the User's Browser</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-attack-consequences" class="internal xref">Attack Consequences</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-exploiting-stolen-refresh-t" class="internal xref">Exploiting Stolen Refresh Tokens</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-exploiting-stolen-access-to" class="internal xref">Exploiting Stolen Access Tokens</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="auto internal xref">5.2.3</a>.  <a href="#name-client-hijacking" class="internal xref">Client Hijacking</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-application-architecture-pa" class="internal xref">Application Architecture Patterns</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-backend-for-frontend-bff" class="internal xref">Backend For Frontend (BFF)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="auto internal xref">6.1.1</a>.  <a href="#name-application-architecture" class="internal xref">Application Architecture</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="auto internal xref">6.1.2</a>.  <a href="#name-implementation-details" class="internal xref">Implementation Details</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.3">
                    <p id="section-toc.1-1.6.2.1.2.3.1"><a href="#section-6.1.3" class="auto internal xref">6.1.3</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.4">
                    <p id="section-toc.1-1.6.2.1.2.4.1"><a href="#section-6.1.4" class="auto internal xref">6.1.4</a>.  <a href="#name-threat-analysis" class="internal xref">Threat Analysis</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-token-mediating-backend" class="internal xref">Token-Mediating Backend</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-application-architecture-2" class="internal xref">Application Architecture</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="auto internal xref">6.2.2</a>.  <a href="#name-implementation-details-2" class="internal xref">Implementation Details</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a href="#section-6.2.3" class="auto internal xref">6.2.3</a>.  <a href="#name-security-considerations-2" class="internal xref">Security Considerations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.4">
                    <p id="section-toc.1-1.6.2.2.2.4.1"><a href="#section-6.2.4" class="auto internal xref">6.2.4</a>.  <a href="#name-threat-analysis-2" class="internal xref">Threat Analysis</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-browser-based-oauth-20-clie" class="internal xref">Browser-based OAuth 2.0 client</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.1">
                    <p id="section-toc.1-1.6.2.3.2.1.1"><a href="#section-6.3.1" class="auto internal xref">6.3.1</a>.  <a href="#name-application-architecture-3" class="internal xref">Application Architecture</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.2">
                    <p id="section-toc.1-1.6.2.3.2.2.1"><a href="#section-6.3.2" class="auto internal xref">6.3.2</a>.  <a href="#name-implementation-details-3" class="internal xref">Implementation Details</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.3">
                    <p id="section-toc.1-1.6.2.3.2.3.1"><a href="#section-6.3.3" class="auto internal xref">6.3.3</a>.  <a href="#name-security-considerations-3" class="internal xref">Security Considerations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.4">
                    <p id="section-toc.1-1.6.2.3.2.4.1"><a href="#section-6.3.4" class="auto internal xref">6.3.4</a>.  <a href="#name-threat-analysis-3" class="internal xref">Threat Analysis</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-discouraged-and-deprecated-" class="internal xref">Discouraged and Deprecated Architecture Patterns</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-single-domain-browser-based" class="internal xref">Single-Domain Browser-Based Applications (not using OAuth)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="auto internal xref">7.1.1</a>.  <a href="#name-threat-analysis-4" class="internal xref">Threat Analysis</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-oauth-implicit-grant" class="internal xref">OAuth Implicit Grant</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.1">
                    <p id="section-toc.1-1.7.2.2.2.1.1"><a href="#section-7.2.1" class="auto internal xref">7.2.1</a>.  <a href="#name-historic-note" class="internal xref">Historic Note</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.2">
                    <p id="section-toc.1-1.7.2.2.2.2.1"><a href="#section-7.2.2" class="auto internal xref">7.2.2</a>.  <a href="#name-threat-analysis-5" class="internal xref">Threat Analysis</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.3">
                    <p id="section-toc.1-1.7.2.2.2.3.1"><a href="#section-7.2.3" class="auto internal xref">7.2.3</a>.  <a href="#name-further-attacks-on-the-impl" class="internal xref">Further Attacks on the Implicit Grant</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2.2.4">
                    <p id="section-toc.1-1.7.2.2.2.4.1"><a href="#section-7.2.4" class="auto internal xref">7.2.4</a>.  <a href="#name-disadvantages-of-the-implic" class="internal xref">Disadvantages of the Implicit Grant</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-resource-owner-password-gra" class="internal xref">Resource Owner Password Grant</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-handling-the-oauth-flow-in-" class="internal xref">Handling the OAuth Flow in a Service Worker</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4.2.1">
                    <p id="section-toc.1-1.7.2.4.2.1.1"><a href="#section-7.4.1" class="auto internal xref">7.4.1</a>.  <a href="#name-threat-analysis-6" class="internal xref">Threat Analysis</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-token-storage-in-the-browse" class="internal xref">Token Storage in the Browser</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-cookies" class="internal xref">Cookies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-token-storage-in-a-service-" class="internal xref">Token Storage in a Service Worker</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-token-storage-in-a-web-work" class="internal xref">Token Storage in a Web Worker</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-in-memory-token-storage" class="internal xref">In-Memory Token Storage</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-persistent-token-storage" class="internal xref">Persistent Token Storage</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="auto internal xref">8.6</a>.  <a href="#name-filesystem-considerations-f" class="internal xref">Filesystem Considerations for Browser Storage APIs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-security-considerations-4" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-reducing-the-authority-of-t" class="internal xref">Reducing the Authority of Tokens</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-sender-constrained-tokens" class="internal xref">Sender-Constrained Tokens</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-authorization-server-mix-up" class="internal xref">Authorization Server Mix-Up Mitigation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-isolating-applications-usin" class="internal xref">Isolating Applications using Origins</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-document-history" class="internal xref">Document History</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This specification describes different architectural patterns for implementing OAuth 2.0 clients in applications executing in a browser. The specification outlines the security challenges for browser-based applications and analyzes how different patterns address these challenges.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">For native application developers using OAuth 2.0 and OpenID Connect, an IETF BCP
(best current practice) was published that guides integration of these technologies.
This document is formally known as RFC8252 or BCP212, but often referred to as "AppAuth" after
the OpenID Foundation-sponsored set of libraries that assist developers in adopting
these practices. <span>[<a href="#RFC8252" class="cite xref">RFC8252</a>]</span> makes specific recommendations for how to securely implement OAuth clients in native
applications, including incorporating additional OAuth extensions where needed.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This specification, OAuth 2.0 for Browser-Based Applications, addresses the similarities between implementing
OAuth clients as native applications and browser-based applications, but also highlights how the security properties of browser-based applications are vastly different than those of native applications. This document is primarily focused on OAuth, except where OpenID Connect provides additional considerations.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">Many of these recommendations are derived from the OAuth 2.0 Security Best Current Practice
<span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> and browser-based applications are expected to follow those recommendations
as well. This document expands on and further restricts various recommendations given in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notational-conventions">
<section id="section-2">
      <h2 id="name-notational-conventions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-notational-conventions" class="section-name selfRef">Notational Conventions</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
"OPTIONAL" in this document are to be interpreted as described in BCP14.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-3">
      <h2 id="name-terminology">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-3-1">In addition to the terms defined in referenced specifications, this document uses
the following terms:<a href="#section-3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3-2">
        <dt id="section-3-2.1">"OAuth":</dt>
        <dd style="margin-left: 1.5em" id="section-3-2.2">
          <p id="section-3-2.2.1">In this document, "OAuth" refers to OAuth 2.0, <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span> and <span>[<a href="#RFC6750" class="cite xref">RFC6750</a>]</span>.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.3">"Browser-based application":</dt>
        <dd style="margin-left: 1.5em" id="section-3-2.4">
          <p id="section-3-2.4.1">An application that is dynamically downloaded and executed in a web browser,
usually written in JavaScript. Also sometimes referred to as a "single-page application", or "SPA".<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-3-3">This document discusses the security of browser-based applications, which are executed by the browser in a runtime environment. In most scenarios, these applications are JavaScript (JS) applications running in a JavaScript execution environment. Given the popularity of this scenario, this document refers to "JavaScript applications" and to "malicious JavaScript" when discussing attack patterns. Note that the recommendations and considerations in this document are not exclusively linked to the JavaScript language or its runtime. The same considerations apply to other languages and runtimes that allow malicious code to execute in the application's runtime in the browser.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="history-of-oauth-20-in-browser-based-applications">
<section id="section-4">
      <h2 id="name-history-of-oauth-20-in-brow">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-history-of-oauth-20-in-brow" class="section-name selfRef">History of OAuth 2.0 in Browser-Based Applications</a>
      </h2>
<p id="section-4-1">At the time that OAuth 2.0 was initially specified in <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span> and <span>[<a href="#RFC6750" class="cite xref">RFC6750</a>]</span>, browser-based JavaScript applications needed a solution that strictly complied with the same-origin policy. Common deployments of OAuth 2.0 involved an application running on a different domain than the authorization server, so it was historically not possible to use the Authorization Code grant type which would require a cross-origin POST request. This limitation was one of the motivations for the definition of the Implicit grant type, which returns the access token in the front channel via the fragment part of the URL, bypassing the need for a cross-origin POST request.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">However, there are several drawbacks to the Implicit grant type, generally involving vulnerabilities associated with the exposure of the access token in the URL. See <a href="#implicit_flow" class="auto internal xref">Section 7.2</a> for an analysis of these attacks and the drawbacks of using the Implicit grant type in browsers. Additional attacks and security considerations can be found in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">In recent years, widespread adoption of Cross-Origin Resource Sharing (CORS) <span>[<a href="#Fetch" class="cite xref">Fetch</a>]</span>, which enables exceptions to the same-origin policy, allows browser-based applications to use the OAuth 2.0 Authorization Code grant type and make a POST request to exchange the authorization code for an access token at the token endpoint. Since the Authorization Code grant type enables the use of refresh tokens for other types of clients, this behavior has been adopted for browser-based clients as well, even though these clients are still public clients with limited to no access to secure storage. Furthermore, adding PKCE to the flow prevents authorization code injection, as well as ensures that even if an authorization code is intercepted, it is unusable by an attacker.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">For this reason, and from other lessons learned, the current best practice for browser-based applications is to use the OAuth 2.0 Authorization Code grant type with PKCE. There are various architectural patterns for deploying browser-based applications, both with and without a corresponding server-side component. Each of these architectures has specific trade-offs and considerations, discussed further in this document. Additional considerations apply for first-party common-domain applications.<a href="#section-4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="threats">
<section id="section-5">
      <h2 id="name-the-threat-of-malicious-jav">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-the-threat-of-malicious-jav" class="section-name selfRef">The Threat of Malicious JavaScript</a>
      </h2>
<p id="section-5-1">Malicious JavaScript poses a significant risk to browser-based applications. Attack vectors, such as cross-site scripting (XSS) or the compromise of remote code files, give an attacker the capability to run arbitrary code in the application's execution context. This malicious code is not isolated from the main application's code in any way. Consequentially, the malicious code can not only take control of the running execution context, but can also perform actions within the application's origin. Concretely, this means that the malicious code can steal data from the current page, interact with other same-origin browsing contexts, send requests to a backend from within the application's origin, steal data from origin-based storage mechanisms (e.g., localStorage, IndexedDB), etc.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">When analyzing the security of browser-based applications in light of the presence of malicious JS, it is crucial to realize that the <strong>malicious JavaScript code has the same privileges as the legitimate application code</strong>. When the application code can access variables or call functions, the malicious JS code can do exactly the same. Furthermore, the malicious JS code can tamper with the regular execution flow of the application, as well as with any application-level defenses, since they are typically controlled from within the application. For example, the attacker can remove or override event listeners, modify the behavior of built-in functions (prototype pollution), and stop pages in frames from loading.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">This section explores the threats malicious JS code poses to browser-based applications that assume the role of an OAuth client. The first part (<a href="#attackscenarios" class="auto internal xref">Section 5.1</a>) discusses a few scenarios that attackers can use once they have found a way to run malicious JavaScript code. These scenarios paint a clear picture of the true power of the attacker, which goes way beyond simple token exfiltration. The second part (<a href="#consequences" class="auto internal xref">Section 5.2</a>) analyzes the impact of these attack scenarios on the OAuth client.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The remainder of this specification will refer back to these attack scenarios and consequences to analyze the security properties of the different architectural patterns.<a href="#section-5-4" class="pilcrow">¶</a></p>
<div id="attackscenarios">
<section id="section-5.1">
        <h3 id="name-malicious-javascript-scenar">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-malicious-javascript-scenar" class="section-name selfRef">Malicious JavaScript Scenarios</a>
        </h3>
<p id="section-5.1-1">This section presents several malicious scenarios that an attacker can execute once they have found a vulnerability that allows the execution of malicious JavaScript code. The attack scenarios include trivial scenarios (<a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a>) and elaborate scenarios (<a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>). Note that this enumeration is non-exhaustive and presented in no particular order.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="scenario-single-theft">
<section id="section-5.1.1">
          <h4 id="name-single-execution-token-thef">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-single-execution-token-thef" class="section-name selfRef">Single-Execution Token Theft</a>
          </h4>
<p id="section-5.1.1-1">This scenario covers a simple token exfiltration attack, where the attacker obtains and exfiltrates the client's current tokens. This scenario consists of the following steps:<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-2.1">
              <p id="section-5.1.1-2.1.1">Execute malicious JS code<a href="#section-5.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.2">
              <p id="section-5.1.1-2.2.1">Obtain tokens from the application's preferred storage mechanism (See <a href="#token-storage" class="auto internal xref">Section 8</a>)<a href="#section-5.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.3">
              <p id="section-5.1.1-2.3.1">Send the tokens to a server controlled by the attacker<a href="#section-5.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.4">
              <p id="section-5.1.1-2.4.1">Store/abuse the stolen tokens<a href="#section-5.1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.1-3">The recommended defensive strategy to protect access tokens is to reduce the scope and lifetime of the token. For refresh tokens, the use of refresh token rotation offers a detection and correction mechanism. Sender-constrained tokens (<a href="#sender-constrained-tokens" class="auto internal xref">Section 9.2</a>) offer an additional layer of protection against stolen access tokens.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4">Note that this attack scenario is trivial and often used to illustrate the dangers of malicious JavaScript. When discussing the security of browser-based applications, it is crucial to avoid limiting the attacker's capabilities to the attack discussed in this scenario.<a href="#section-5.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scenario-persistent-theft">
<section id="section-5.1.2">
          <h4 id="name-persistent-token-theft">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-persistent-token-theft" class="section-name selfRef">Persistent Token Theft</a>
          </h4>
<p id="section-5.1.2-1">This attack scenario is a more advanced variation on the Single-Execution Token Theft scenario (<a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a>). Instead of immediately stealing tokens upon the execution of the malicious code, the attacker sets up the necessary handlers to steal the application's tokens on a continuous basis. This scenario consists of the following steps:<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-2.1">
              <p id="section-5.1.2-2.1.1">Execute malicious JS code<a href="#section-5.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.2-2.2">
              <p id="section-5.1.2-2.2.1">Setup a continuous token theft mechanism (e.g., on a 10-second time interval)<a href="#section-5.1.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-2.2.2.1">
                  <p id="section-5.1.2-2.2.2.1.1">Obtain tokens from the application's preferred storage mechanism (See <a href="#token-storage" class="auto internal xref">Section 8</a>)<a href="#section-5.1.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.2-2.2.2.2">
                  <p id="section-5.1.2-2.2.2.2.1">Send the tokens to a server controlled by the attacker<a href="#section-5.1.2-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.1.2-2.2.2.3">
                  <p id="section-5.1.2-2.2.2.3.1">Store the tokens<a href="#section-5.1.2-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.1.2-2.3">
              <p id="section-5.1.2-2.3.1">Wait until the opportune moment to abuse the latest version of the stolen tokens<a href="#section-5.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.2-3">The crucial difference in this scenario is that the attacker always has access to the latest tokens used by the application. This slight variation in the attack scenario already suffices to counter typical defenses against token theft, such as short lifetimes or refresh token rotation.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.2-4">For access tokens, the attacker now obtains the latest access token for as long as the user's browser is online. Refresh token rotation is not sufficient to prevent abuse of a refresh token. An attacker can easily wait until the user closes the application or their browser goes offline before using the latest refresh token, thereby ensuring that the latest refresh token is not reused.<a href="#section-5.1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scenario-new-flow">
<section id="section-5.1.3">
          <h4 id="name-acquisition-and-extraction-">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-acquisition-and-extraction-" class="section-name selfRef">Acquisition and Extraction of New Tokens</a>
          </h4>
<p id="section-5.1.3-1">In this advanced attack scenario, the attacker completely disregards any tokens that the application has already obtained. Instead, the attacker takes advantage of the ability to run malicious code that is associated with the application's origin. With that ability, the attacker can inject a hidden iframe and launch a silent Authorization Code flow. This silent flow will reuse the user's existing session with the authorization server and result in the issuing of a new, independent set of tokens. This scenario consists of the following steps:<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.3-2.1">
              <p id="section-5.1.3-2.1.1">Execute malicious JS code<a href="#section-5.1.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.3-2.2">
              <p id="section-5.1.3-2.2.1">Set up a handler to obtain the authorization code from the iframe (e.g., by monitoring the frame's URL or via Web Messaging (<span>[<a href="#WebMessaging" class="cite xref">WebMessaging</a>]</span>))<a href="#section-5.1.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.3-2.3">
              <p id="section-5.1.3-2.3.1">Insert a hidden iframe into the page and initialize it with an authorization request. The authorization request in the iframe will occur within the user's session and, if the session is still active, result in the issuing of an authorization code. Note that this step relies on the Authorization Server supporting silent frame-based flows, as discussed in the last paragraph of this scenario.<a href="#section-5.1.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.3-2.4">
              <p id="section-5.1.3-2.4.1">Extract the authorization code from the iframe using the previously installed handler<a href="#section-5.1.3-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.3-2.5">
              <p id="section-5.1.3-2.5.1">Send the authorization code to a server controlled by the attacker<a href="#section-5.1.3-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.3-2.6">
              <p id="section-5.1.3-2.6.1">Exchange the authorization code for a new set of tokens<a href="#section-5.1.3-2.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.3-2.7">
              <p id="section-5.1.3-2.7.1">Abuse the stolen tokens<a href="#section-5.1.3-2.7.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.3-3">The most important takeaway from this scenario is that it runs a new OAuth flow instead of focusing on stealing existing tokens. In essence, even if the application finds a token storage mechanism with perfect security, the attacker will still be able to request a new set of tokens. Note that because the attacker controls the application in the browser, the attacker's Authorization Code flow is indistinguishable from a legitimate Authorization Code flow.<a href="#section-5.1.3-3" class="pilcrow">¶</a></p>
<p id="section-5.1.3-4">This attack scenario is possible because the security of public browser-based OAuth clients relies entirely on the redirect URI and application's origin. When the attacker executes malicious JavaScript code in the application's origin, they gain the capability to inspect same-origin frames. As a result, the attacker's code running in the main execution context can inspect the redirect URI loaded in the same-origin frame to extract the authorization code.<a href="#section-5.1.3-4" class="pilcrow">¶</a></p>
<p id="section-5.1.3-5">There are no practical security mechanisms for frontend applications that counter this attack scenario. Short access token lifetimes and refresh token rotation are ineffective, since the attacker has a fresh, independent set of tokens. Advanced security mechanism, such as DPoP <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span> are equally ineffective, since the attacker can use their own key pair to setup and use DPoP for the newly obtained tokens. Requiring user interaction with every Authorization Code flow would effectively stop the automatic silent issuance of new tokens, but this would significantly impact widely-established patterns, such as bootstrapping an application on its first page load, or single sign-on across multiple related applications, and is not a practical measure.<a href="#section-5.1.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scenario-proxy">
<section id="section-5.1.4">
          <h4 id="name-proxying-requests-via-the-u">
<a href="#section-5.1.4" class="section-number selfRef">5.1.4. </a><a href="#name-proxying-requests-via-the-u" class="section-name selfRef">Proxying Requests via the User's Browser</a>
          </h4>
<p id="section-5.1.4-1">This attack scenario involves the attacker sending requests to the resource server directly from within the OAuth client application running in the user's browser. In this scenario, there is no need for the attacker to abuse the application to obtain tokens, since the browser will include its own cookies or tokens along in the request. The requests to the resource server sent by the attacker are indistinguishable from requests sent by the legitimate application, since the attacker is running code in the same context as the legitimate application. This scenario consists of the following steps:<a href="#section-5.1.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.4-2.1">
              <p id="section-5.1.4-2.1.1">Execute malicious JS code<a href="#section-5.1.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.4-2.2">
              <p id="section-5.1.4-2.2.1">Send a request to a resource server and process the response<a href="#section-5.1.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.4-3">To authorize the requests to the resource server, the attacker simply mimics the behavior of the client application. For example, when a client application programmatically attaches an access token to outgoing requests, the attacker does the same. Should the client application rely on an external component to augment the request with the proper access token, then this external component will also augment the attacker's request.<a href="#section-5.1.4-3" class="pilcrow">¶</a></p>
<p id="section-5.1.4-4">This attack pattern is well-known and also occurs with traditional applications using <code>HttpOnly</code> session cookies. It is commonly accepted that this scenario cannot be stopped or prevented by application-level security measures. For example, DPoP <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span> explicitly considers this attack scenario to be out of scope.<a href="#section-5.1.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="consequences">
<section id="section-5.2">
        <h3 id="name-attack-consequences">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-attack-consequences" class="section-name selfRef">Attack Consequences</a>
        </h3>
<p id="section-5.2-1">Successful execution of an attack scenario can result in the theft of access tokens and refresh tokens, or in the ability to hijack the client application running in the user's browser. Each of these consequences is relevant for browser-based OAuth clients. They are discussed below in decreasing order of severity.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div id="consequence-rt">
<section id="section-5.2.1">
          <h4 id="name-exploiting-stolen-refresh-t">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-exploiting-stolen-refresh-t" class="section-name selfRef">Exploiting Stolen Refresh Tokens</a>
          </h4>
<p id="section-5.2.1-1">When the attacker obtains a valid refresh token from a browser-based OAuth client, they can abuse the refresh token by running a Refresh Token grant with the authorization server. The response of the Refresh Token grant contains an access token, which gives the attacker the ability to access protected resources (See <a href="#consequence-at" class="auto internal xref">Section 5.2.2</a>). In essence, abusing a stolen refresh token enables long-term impersonation of the legitimate client application to resource servers.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-5.2.1-2">The attack is only stopped when the authorization server refuses a refresh token because it has expired or rotated, or when the refresh token is revoked. In a typical browser-based OAuth client, it is not uncommon for a refresh token to remain valid for multiple hours, or even days.<a href="#section-5.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="consequence-at">
<section id="section-5.2.2">
          <h4 id="name-exploiting-stolen-access-to">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-exploiting-stolen-access-to" class="section-name selfRef">Exploiting Stolen Access Tokens</a>
          </h4>
<p id="section-5.2.2-1">If the attacker obtains a valid access token, they gain the ability to impersonate the legitimate client application in a request to a resource server. Concretely, possession of an access token allows the attacker to send arbitrary requests to any resource server that accepts the valid access token. In essence, abusing a stolen access token enables short-term impersonation of the legitimate client application to resource servers.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2.2-2">The attack ends when the access token expires or when a token is revoked with the authorization server. In a typical browser-based OAuth client, access token lifetimes can be quite short, ranging from minutes to hours.<a href="#section-5.2.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2.2-3">Note that the possession of the access token allows its unrestricted use by the attacker. The attacker can send arbitrary requests to resource servers, using any HTTP method, destination URL, header values, or body.<a href="#section-5.2.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2.2-4">The application can use DPoP to ensure its access tokens are bound to non-exportable keys held by the browser. In that case, it becomes significantly harder for the attacker to abuse stolen access tokens. More specifically, with DPoP, the attacker can only abuse stolen application tokens by carrying out an online attack, where the proofs are calculated in the user's browser. This attack is described in detail in section 11.4 of <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span>. However, when the attacker obtains a fresh set of tokens, as described in <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>, they can set up DPoP for these tokens using an attacker-controlled key pair. In that case, the attacker is again free to abuse this newly obtained access token without restrictions.<a href="#section-5.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="consequence-hijack">
<section id="section-5.2.3">
          <h4 id="name-client-hijacking">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-client-hijacking" class="section-name selfRef">Client Hijacking</a>
          </h4>
<p id="section-5.2.3-1">When stealing tokens is not possible or desirable, the attacker can also choose to hijack the OAuth client application running in the user's browser. This effectively allows the attacker to perform any operations that the legitimate client application can perform. Examples include inspecting data on the page, modifying the page, and sending requests to backend systems.<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<p id="section-5.2.3-2">Note that client hijacking is less powerful than directly abusing stolen tokens. In a client hijacking scenario, the attacker cannot directly control the tokens and is restricted by the security policies enforced on the client application. For example, a resource server running on <code>admin.example.org</code> can be configured with a CORS policy that rejects requests coming from a client running on <code>web.example.org</code>. Even if the access token used by the client would be accepted by the resource server, the resource server's strict CORS configuration does not allow such a request. A resource server without such a strict CORS policy can still be subject to adversarial requests coming from the compromised client application.<a href="#section-5.2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="application-architecture-patterns">
<section id="section-6">
      <h2 id="name-application-architecture-pa">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-application-architecture-pa" class="section-name selfRef">Application Architecture Patterns</a>
      </h2>
<p id="section-6-1">There are three main architectural patterns available when building browser-based JavaScript applications that rely on OAuth for accessing protected resources.<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">A JavaScript application that relies on a backend component for handling OAuth responsibilities and proxies all requests through the backend component (Backend-For-Frontend or BFF)<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.2">
          <p id="section-6-2.2.1">A JavaScript application that relies on a backend component for handling OAuth responsibilities, but calls resource servers directly using the access token (Token-Mediating Backend)<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.3">
          <p id="section-6-2.3.1">A JavaScript application acting as the client, handling all OAuth responsibilities in the browser (Browser-based OAuth Client)<a href="#section-6-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-6-3">Each of these architecture patterns offer a different trade-off between security and simplicity. The patterns in this section are presented in decreasing order of security.<a href="#section-6-3" class="pilcrow">¶</a></p>
<div id="pattern-bff">
<section id="section-6.1">
        <h3 id="name-backend-for-frontend-bff">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-backend-for-frontend-bff" class="section-name selfRef">Backend For Frontend (BFF)</a>
        </h3>
<p id="section-6.1-1">This section describes the architecture of a JavaScript application that relies on a backend component to handle all OAuth responsibilities and API interactions. The BFF has three core responsibilities:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.1-2">
<li id="section-6.1-2.1">
            <p id="section-6.1-2.1.1">The BFF interacts with the authorization server as a confidential OAuth client<a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">The BFF manages OAuth access and refresh tokens in the context of a cookie-based session, avoiding the direct exposure of any tokens to the JavaScript application<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-2.3">
            <p id="section-6.1-2.3.1">The BFF proxies all requests to a resource server, augmenting them with the correct access token before forwarding them to the resource server<a href="#section-6.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.1-3">If an attacker is able to execute malicious code within the JavaScript application, the application architecture is able to withstand most of the attack scenarios discussed before. Since tokens are only available to the BFF, there are no tokens available to extract from JavaScript (Single-Execution Token Theft (<a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a>) and Persistent Token Theft (<a href="#scenario-persistent-theft" class="auto internal xref">Section 5.1.2</a>)). The BFF is a confidential client, which prevents the attacker from running a new flow within the browser (Acquisition and Extraction of New Tokens (<a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>)). Since the malicious JavaScript code still runs within the application's origin, the attacker is able to send requests to the BFF from within the user's browser (Proxying Requests via the User's Browser (<a href="#scenario-proxy" class="auto internal xref">Section 5.1.4</a>)).<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<div id="application-architecture">
<section id="section-6.1.1">
          <h4 id="name-application-architecture">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-application-architecture" class="section-name selfRef">Application Architecture</a>
          </h4>
<span id="name-oauth-20-bff-pattern"></span><div id="fig-bbapp-pattern-bff">
<figure id="figure-1">
            <div id="section-6.1.1-1.1">
              <div class="alignLeft art-svg artwork" id="section-6.1.1-1.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="448" width="576" viewBox="0 0 576 448" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,368 L 8,432" fill="none" stroke="black"></path>
                  <path d="M 152,368 L 152,432" fill="none" stroke="black"></path>
                  <path d="M 184,32 L 184,112" fill="none" stroke="black"></path>
                  <path d="M 232,368 L 232,432" fill="none" stroke="black"></path>
                  <path d="M 256,144 L 256,336" fill="none" stroke="black"></path>
                  <path d="M 288,208 L 288,272" fill="none" stroke="black"></path>
                  <path d="M 312,32 L 312,112" fill="none" stroke="black"></path>
                  <path d="M 320,304 L 320,336" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 368,112" fill="none" stroke="black"></path>
                  <path d="M 368,304 L 368,336" fill="none" stroke="black"></path>
                  <path d="M 416,144 L 416,176" fill="none" stroke="black"></path>
                  <path d="M 416,304 L 416,336" fill="none" stroke="black"></path>
                  <path d="M 456,32 L 456,112" fill="none" stroke="black"></path>
                  <path d="M 464,304 L 464,336" fill="none" stroke="black"></path>
                  <path d="M 480,32 L 480,112" fill="none" stroke="black"></path>
                  <path d="M 512,304 L 512,336" fill="none" stroke="black"></path>
                  <path d="M 520,144 L 520,176" fill="none" stroke="black"></path>
                  <path d="M 536,208 L 536,272" fill="none" stroke="black"></path>
                  <path d="M 536,304 L 536,336" fill="none" stroke="black"></path>
                  <path d="M 568,32 L 568,112" fill="none" stroke="black"></path>
                  <path d="M 568,368 L 568,432" fill="none" stroke="black"></path>
                  <path d="M 184,32 L 312,32" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 456,32" fill="none" stroke="black"></path>
                  <path d="M 480,32 L 568,32" fill="none" stroke="black"></path>
                  <path d="M 184,112 L 312,112" fill="none" stroke="black"></path>
                  <path d="M 368,112 L 456,112" fill="none" stroke="black"></path>
                  <path d="M 480,112 L 568,112" fill="none" stroke="black"></path>
                  <path d="M 288,208 L 536,208" fill="none" stroke="black"></path>
                  <path d="M 288,272 L 536,272" fill="none" stroke="black"></path>
                  <path d="M 8,368 L 152,368" fill="none" stroke="black"></path>
                  <path d="M 232,368 L 568,368" fill="none" stroke="black"></path>
                  <path d="M 168,400 L 216,400" fill="none" stroke="black"></path>
                  <path d="M 8,432 L 152,432" fill="none" stroke="black"></path>
                  <path d="M 232,432 L 568,432" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="544,336 532,330.4 532,341.6" fill="black" transform="rotate(90,536,336)"></polygon>
                  <polygon class="arrowhead" points="528,176 516,170.4 516,181.6" fill="black" transform="rotate(90,520,176)"></polygon>
                  <polygon class="arrowhead" points="528,144 516,138.4 516,149.6" fill="black" transform="rotate(270,520,144)"></polygon>
                  <polygon class="arrowhead" points="520,304 508,298.4 508,309.6" fill="black" transform="rotate(270,512,304)"></polygon>
                  <polygon class="arrowhead" points="472,336 460,330.4 460,341.6" fill="black" transform="rotate(90,464,336)"></polygon>
                  <polygon class="arrowhead" points="424,304 412,298.4 412,309.6" fill="black" transform="rotate(270,416,304)"></polygon>
                  <polygon class="arrowhead" points="424,176 412,170.4 412,181.6" fill="black" transform="rotate(90,416,176)"></polygon>
                  <polygon class="arrowhead" points="424,144 412,138.4 412,149.6" fill="black" transform="rotate(270,416,144)"></polygon>
                  <polygon class="arrowhead" points="376,336 364,330.4 364,341.6" fill="black" transform="rotate(90,368,336)"></polygon>
                  <polygon class="arrowhead" points="376,304 364,298.4 364,309.6" fill="black" transform="rotate(270,368,304)"></polygon>
                  <polygon class="arrowhead" points="328,336 316,330.4 316,341.6" fill="black" transform="rotate(90,320,336)"></polygon>
                  <polygon class="arrowhead" points="328,304 316,298.4 316,309.6" fill="black" transform="rotate(270,320,304)"></polygon>
                  <polygon class="arrowhead" points="264,336 252,330.4 252,341.6" fill="black" transform="rotate(90,256,336)"></polygon>
                  <polygon class="arrowhead" points="264,144 252,138.4 252,149.6" fill="black" transform="rotate(270,256,144)"></polygon>
                  <polygon class="arrowhead" points="224,400 212,394.4 212,405.6" fill="black" transform="rotate(0,216,400)"></polygon>
                  <g class="text">
                    <text x="248" y="68">Authorization</text>
                    <text x="408" y="68">Token</text>
                    <text x="524" y="68">Resource</text>
                    <text x="244" y="84">Endpoint</text>
                    <text x="412" y="84">Endpoint</text>
                    <text x="524" y="84">Server</text>
                    <text x="400" y="164">(F)</text>
                    <text x="504" y="164">(K)</text>
                    <text x="336" y="244">Backend</text>
                    <text x="384" y="244">for</text>
                    <text x="436" y="244">Frontend</text>
                    <text x="496" y="244">(BFF)</text>
                    <text x="240" y="260">(D)</text>
                    <text x="296" y="324">(B,I)</text>
                    <text x="352" y="324">(C)</text>
                    <text x="400" y="324">(E)</text>
                    <text x="448" y="324">(G)</text>
                    <text x="496" y="324">(J)</text>
                    <text x="552" y="324">(L)</text>
                    <text x="192" y="388">(A,H)</text>
                    <text x="44" y="404">Static</text>
                    <text x="88" y="404">Web</text>
                    <text x="124" y="404">Host</text>
                    <text x="400" y="404">Browser</text>
                  </g>
                </svg><a href="#section-6.1.1-1.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-oauth-20-bff-pattern" class="selfRef">OAuth 2.0 BFF Pattern</a>
            </figcaption></figure>
</div>
<p id="section-6.1.1-2">In this architecture, the JavaScript code is first loaded from a static web host into the browser (A), and the application then runs in the browser. The application checks with the BFF if there is an active session by calling a "check session" API endpoint (B). If an active session is found, the application resumes its authenticated state and skips forward to step J.<a href="#section-6.1.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1.1-3">When no active session is found, the JavaScript application triggers a navigation to the BFF (C) to initiate the Authorization Code flow with the PKCE
extension (described in <a href="#pattern-bff-flow" class="auto internal xref">Section 6.1.3.1</a>), to which the BFF responds by redirecting the browser to the authorization endpoint (D). When the user is redirected back, the browser delivers the authorization code to the BFF (E), where the BFF can then exchange it for tokens at the token endpoint (F) using its client credentials and PKCE code verifier.<a href="#section-6.1.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1.1-4">The BFF associates the obtained tokens with the user's session (See <a href="#pattern-bff-sessions" class="auto internal xref">Section 6.1.2.3</a>) and sets a cookie in the response to keep track of this session (G). This response to the browser will also trigger the reloading of the JavaScript application (H). When this application reloads, it will check with the BFF for an existing session (I), allowing the JavaScript application to resume its authenticated state.<a href="#section-6.1.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1.1-5">When the JavaScript application in the browser wants to make a request to the resource server, it sends a request to the corresponding endpoint on the BFF (J). This request will include the cookie set in step G, allowing the BFF to obtain the proper tokens for this user's session. The BFF removes the cookie from the request, attaches the user's access token to the request, and forwards it to the actual resource server (K). The BFF then forwards the response back to the browser-based application (L).<a href="#section-6.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-details">
<section id="section-6.1.2">
          <h4 id="name-implementation-details">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-implementation-details" class="section-name selfRef">Implementation Details</a>
          </h4>
<div id="bff_endpoints">
<section id="section-6.1.2.1">
            <h5 id="name-session-and-oauth-endpoints">
<a href="#section-6.1.2.1" class="section-number selfRef">6.1.2.1. </a><a href="#name-session-and-oauth-endpoints" class="section-name selfRef">Session and OAuth Endpoints</a>
            </h5>
<p id="section-6.1.2.1-1">The BFF provides a set of endpoints that are crucial to implement the interactions between the browser-based application and the BFF. This section discusses these endpoints in a bit more detail to clarify their purpose and use cases.<a href="#section-6.1.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2.1-2">The "check session" endpoint (Steps B and I in the diagram above) is an API endpoint called by the browser-based application. The request will carry session information when available, allowing the BFF to check for an active session. The response should indicate to the browser-based application whether the session is active. Additionally, the BFF can include other information, such as identity information about the authenticated user.<a href="#section-6.1.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1.2.1-3">The endpoint that initializes the Authorization Code flow (step C) is contacted by the browser through a navigation. When the JavaScript application detects an unauthenticated state after checking the session (step B), it can navigate the browser to this endpoint. Doing so allows the BFF to respond with a redirect, which takes the browser to the authorization server. The endpoint to initialize this flow is typically included as the "login" endpoint by libraries that support OAuth 2.0 for confidential clients running on a web server. Note that it is also possible for the BFF to initialize the Authorization Code flow in step B, when it detects the absence of an active session. In that case, the BFF would return the initialization URI in the response and expect the JavaScript application to trigger a navigation event with this URI. However, this scenario requires a custom implementation and makes it harder to use standard OAuth libraries.<a href="#section-6.1.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1.2.1-4">The endpoint that receives the authorization code (step E) is called by a navigation event from within the browser. At this point, the JavaScript application is not loaded and not in a position to handle the redirect. Similar to the initialization of the flow, the endpoint to handle the redirect is offered by standard OAuth libraries. The BFF can respond to this request with a redirect that triggers the browser to load the  JavaScript application.<a href="#section-6.1.2.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1.2.1-5">Finally, the BFF can also offer a "logout" endpoint to the JavaScript application, which is not depicted in the diagram above. The exact behavior of the logout endpoint depends on the application requirements. Note that standard OAuth libraries typically also offer an implementation of the "logout" endpoint.<a href="#section-6.1.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="refresh-tokens">
<section id="section-6.1.2.2">
            <h5 id="name-refresh-tokens">
<a href="#section-6.1.2.2" class="section-number selfRef">6.1.2.2. </a><a href="#name-refresh-tokens" class="section-name selfRef">Refresh Tokens</a>
            </h5>
<p id="section-6.1.2.2-1">When using refresh tokens, as described in Section 4.14 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>, the BFF obtains the refresh token (step F) and associates it with the user's session.<a href="#section-6.1.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2.2-2">If the BFF notices that the user's access token has expired and the BFF has a refresh token, it can use the refresh token to obtain a fresh access token. These steps are not shown in the diagram, but would occur between step J and K. Note that this BFF client is a confidential client, so it will use its client authentication in the refresh token request.<a href="#section-6.1.2.2-2" class="pilcrow">¶</a></p>
<p id="section-6.1.2.2-3">When the refresh token expires, there is no way to obtain a valid access token without running an entirely new Authorization Code flow. Therefore, it is recommended to configure the lifetime of the cookie-based session managed by the BFF to be equal to the maximum lifetime of the refresh token. Additionally, when the BFF learns that a refresh token for an active session is no longer valid, it is recommended to invalidate the session.<a href="#section-6.1.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-bff-sessions">
<section id="section-6.1.2.3">
            <h5 id="name-cookie-based-session-manage">
<a href="#section-6.1.2.3" class="section-number selfRef">6.1.2.3. </a><a href="#name-cookie-based-session-manage" class="section-name selfRef">Cookie-based Session Management</a>
            </h5>
<p id="section-6.1.2.3-1">The BFF relies on browser cookies (<span>[<a href="#draft-ietf-httpbis-rfc6265bis" class="cite xref">draft-ietf-httpbis-rfc6265bis</a>]</span>) to keep track of the user's session, which is used to access the user's tokens. Cookie-based sessions, both server-side and client-side, have some downsides.<a href="#section-6.1.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2.3-2">Server-side sessions expose only a session identifier and keep all data on the server. Doing so ensures a great level of control over active sessions, along with the possibility to revoke any session at will. The downside of this approach is the impact on scalability, requiring solutions such as "sticky sessions", or "session replication". Given these downsides, using server-side sessions with a BFF is only recommended in small-scale scenarios.<a href="#section-6.1.2.3-2" class="pilcrow">¶</a></p>
<p id="section-6.1.2.3-3">Client-side sessions push all data to the browser in a signed, and optionally encrypted, object. This pattern absolves the server of keeping track of any session data, but severely limits control over active sessions and makes it difficult to handle session revocation. However, when client-side sessions are used in the context of a BFF, these properties change significantly. Since the cookie-based session is only used to obtain a user's tokens, all control and revocation properties follow from the use of access tokens and refresh tokens. It suffices to revoke the user's access token and/or refresh token to prevent ongoing access to protected resources, without the need to explicitly invalidate the cookie-based session.<a href="#section-6.1.2.3-3" class="pilcrow">¶</a></p>
<p id="section-6.1.2.3-4">Best practices to secure the session cookie are discussed in <a href="#pattern-bff-cookie-security" class="auto internal xref">Section 6.1.3.2</a>.<a href="#section-6.1.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-bff-oidc">
<section id="section-6.1.2.4">
            <h5 id="name-combining-oauth-and-openid-">
<a href="#section-6.1.2.4" class="section-number selfRef">6.1.2.4. </a><a href="#name-combining-oauth-and-openid-" class="section-name selfRef">Combining OAuth and OpenID Connect</a>
            </h5>
<p id="section-6.1.2.4-1">The OAuth flow used by this application architecture can be combined with OpenID Connect by including the necessary OpenID Connect scopes in the authorization request (C). In that case, the BFF will receive an ID Token in step F. The BFF can associate the information from the ID Token with the user's session and provide it to the JavaScript application in step B or I.<a href="#section-6.1.2.4-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2.4-2">When needed, the BFF can use the access token associated with the user's session to make requests to the UserInfo endpoint.<a href="#section-6.1.2.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="practical-deployment-scenarios">
<section id="section-6.1.2.5">
            <h5 id="name-practical-deployment-scenar">
<a href="#section-6.1.2.5" class="section-number selfRef">6.1.2.5. </a><a href="#name-practical-deployment-scenar" class="section-name selfRef">Practical Deployment Scenarios</a>
            </h5>
<p id="section-6.1.2.5-1">Serving the static JavaScript code is a separate responsibility from handling OAuth tokens and proxying requests. In the diagram presented above, the BFF and static web host are shown as two separate entities. In real-world deployment scenarios, these components can be deployed as a single service (i.e., the BFF serving the static JS code), as two separate services (i.e., a CDN and a BFF), or as two components in a single service (i.e., static hosting and serverless functions on a cloud platform).<a href="#section-6.1.2.5-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2.5-2">Note that it is possible to further customize this architecture to tailor to specific scenarios. For example, an application relying on both internal and external resource servers can choose to host the internal resource server alongside the BFF. In that scenario, requests to the internal resource server are handled directly at the BFF, without the need to proxy requests over the network. Authorization from the point of view of the resource server does not change, as the user's session is internally translated to the access token and its claims.<a href="#section-6.1.2.5-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-6.1.3">
          <h4 id="name-security-considerations">
<a href="#section-6.1.3" class="section-number selfRef">6.1.3. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
          </h4>
<div id="pattern-bff-flow">
<section id="section-6.1.3.1">
            <h5 id="name-the-authorization-code-gran">
<a href="#section-6.1.3.1" class="section-number selfRef">6.1.3.1. </a><a href="#name-the-authorization-code-gran" class="section-name selfRef">The Authorization Code Grant</a>
            </h5>
<p id="section-6.1.3.1-1">The main benefit of using a BFF is the BFF's ability to act as a confidential client. Therefore, the BFF MUST act as a confidential client. Furthermore, the BFF MUST use the OAuth 2.0 Authorization Code grant as described by Section 2.1.1 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> to initiate a request for an access token.<a href="#section-6.1.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-bff-cookie-security">
<section id="section-6.1.3.2">
            <h5 id="name-cookie-security">
<a href="#section-6.1.3.2" class="section-number selfRef">6.1.3.2. </a><a href="#name-cookie-security" class="section-name selfRef">Cookie Security</a>
            </h5>
<p id="section-6.1.3.2-1">The BFF uses cookies to create a user session, which is directly associated with the user's tokens, either through server-side or client-side session state. Given the sensitive nature of these cookies, they must be properly protected.<a href="#section-6.1.3.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.3.2-2">The following cookie security guidelines are relevant for this particular BFF architecture:<a href="#section-6.1.3.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.3.2-3.1">
                <p id="section-6.1.3.2-3.1.1">The BFF MUST enable the <em>Secure</em> flag for its cookies<a href="#section-6.1.3.2-3.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.3.2-3.2">
                <p id="section-6.1.3.2-3.2.1">The BFF MUST enable the <em>HttpOnly</em> flag for its cookies<a href="#section-6.1.3.2-3.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.3.2-3.3">
                <p id="section-6.1.3.2-3.3.1">The BFF SHOULD enable the <em>SameSite=Strict</em> flag for its cookies<a href="#section-6.1.3.2-3.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.3.2-3.4">
                <p id="section-6.1.3.2-3.4.1">The BFF SHOULD set its cookie path to <em>/</em><a href="#section-6.1.3.2-3.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.3.2-3.5">
                <p id="section-6.1.3.2-3.5.1">The BFF SHOULD NOT set the <em>Domain</em> attribute for cookies<a href="#section-6.1.3.2-3.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.3.2-3.6">
                <p id="section-6.1.3.2-3.6.1">The BFF SHOULD start the name of its cookies with the <em>__Host-</em> prefix (<span>[<a href="#CookiePrefixes" class="cite xref">CookiePrefixes</a>]</span>)<a href="#section-6.1.3.2-3.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.1.3.2-4">Additionally, when using client-side sessions that contain access tokens, (as opposed to server-side sessions where the tokens only live on the server), the BFF SHOULD encrypt its cookie contents. This ensures that tokens stored in cookies are never written to the user's hard drive in plaintext format. This security measure helps ensure the  confidentiality of the tokens in case an attacker is able to read cookies from the hard drive. Such an attack can be launched through malware running on the victim's computer. Note that while encrypting the cookie contents prevents direct access to embedded tokens, it still allows the attacker to use the encrypted cookie in a session hijacking attack.<a href="#section-6.1.3.2-4" class="pilcrow">¶</a></p>
<p id="section-6.1.3.2-5">For further guidance on cookie security best practices, we refer to the OWASP Cheat Sheet series (<a href="https://cheatsheetseries.owasp.org">https://cheatsheetseries.owasp.org</a>).<a href="#section-6.1.3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-bff-csrf">
<section id="section-6.1.3.3">
            <h5 id="name-cross-site-request-forgery-">
<a href="#section-6.1.3.3" class="section-number selfRef">6.1.3.3. </a><a href="#name-cross-site-request-forgery-" class="section-name selfRef">Cross-Site Request Forgery Protections</a>
            </h5>
<p id="section-6.1.3.3-1">The interactions between the JavaScript application and the BFF rely on cookies for authentication and authorization. Similar to other cookie-based interactions, the BFF is required to account for Cross-Site Request Forgery (CSRF) attacks.<a href="#section-6.1.3.3-1" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3-2">The BFF MUST implement a proper CSRF defense. The exact mechanism or combination of mechanisms depends on the exact domain where the BFF is deployed, as discussed below.<a href="#section-6.1.3.3-2" class="pilcrow">¶</a></p>
<div id="samesite-cookie-attribute">
<section id="section-6.1.3.3.1">
              <h6 id="name-samesite-cookie-attribute">
<a href="#section-6.1.3.3.1" class="section-number selfRef">6.1.3.3.1. </a><a href="#name-samesite-cookie-attribute" class="section-name selfRef">SameSite Cookie Attribute</a>
              </h6>
<p id="section-6.1.3.3.1-1">Configuring the cookies with the <em>SameSite=Strict</em> attribute (See <a href="#pattern-bff-cookie-security" class="auto internal xref">Section 6.1.3.2</a>) ensures that the BFF's cookies are only included on same-site requests, and not on potentially malicious cross-site requests.<a href="#section-6.1.3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.1-2">This defense is adequate if the BFF is never considered to be same-site with any other applications. However, it falls short when the BFF is hosted alongside other applications within the same site, defined as the eTLD+1 (See this definition of <span>[<a href="#Site" class="cite xref">Site</a>]</span> for more details).<a href="#section-6.1.3.3.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.1-3">For example, subdomains, such as  <code>https://a.example.com</code> and <code>https://b.example.com</code>, are considered same-site, since they share the same site <code>example.com</code>. They are considered cross-origin, since origins consist of the tuple <em>&lt;scheme, hostname, port&gt;</em>. As a result, a subdomain takeover attack against <code>b.example.com</code> can enable CSRF attacks against the BFF of <code>a.example.com</code>. Note that these subdomain-based attacks follow the same pattern as CSRF attacks, but with cross-origin nature instead of a cross-site nature.<a href="#section-6.1.3.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cors">
<section id="section-6.1.3.3.2">
              <h6 id="name-cross-origin-resource-shari">
<a href="#section-6.1.3.3.2" class="section-number selfRef">6.1.3.3.2. </a><a href="#name-cross-origin-resource-shari" class="section-name selfRef">Cross-Origin Resource Sharing</a>
              </h6>
<p id="section-6.1.3.3.2-1">The BFF can rely on CORS as a CSRF defense mechanism. CORS is a security mechanism implemented by browsers that restricts cross-origin JavaScript-based requests, unless the server explicitly approves such a request by setting the proper CORS headers.<a href="#section-6.1.3.3.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.2-2">Browsers typically restrict cross-origin HTTP requests initiated from scripts. CORS can remove this restriction if the target server approves the request, which is checked through an initial "preflight" request. Unless the preflight response explicitly approves the request, the browser will refuse to send the full request.<a href="#section-6.1.3.3.2-2" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.2-3">Because of this property, the BFF can rely on CORS as a CSRF defense. When the attacker tries to launch a cross-origin request to the BFF from the user's browser, the BFF will not approve the request in the preflight response, causing the browser to block the actual request. Note that the attacker can always launch the request from their own machine, but then the request will not carry the user's cookies, so the attack will fail.<a href="#section-6.1.3.3.2-3" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.2-4">When relying on CORS as a CSRF defense, it is important to realize that certain requests are possible without a preflight. For such requests, named "CORS-safelisted Requests", the browser will simply send the request and prevent access to the response if the server did not send the proper CORS headers. This behavior is enforced for requests that can be triggered via other means than JavaScript, such as a GET request or a form-based POST request.<a href="#section-6.1.3.3.2-4" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.2-5">The consequence of this behavior is that certain endpoints of the resource server could become vulnerable to CSRF, even with CORS enabled as a defense. For example, if the resource server is an API that exposes an endpoint to a body-less POST request, there will be no preflight request and no CSRF defense.<a href="#section-6.1.3.3.2-5" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.2-6">To avoid such bypasses against the CORS policy, the BFF SHOULD require that the JavaScript application includes a custom request header. Cross-origin requests with a custom request header always require a preflight, which makes CORS an effective CSRF defense. When this mechanism is used, the BFF MUST ensure that every incoming request carries this static header. The exact naming of this header is at the discretion of the JavaScript application and BFF. A sample configuration would be a request header with a static value, such as <code>My-Static-Header: 1</code>.<a href="#section-6.1.3.3.2-6" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.2-7">It is also possible to deploy the JavaScript application on the same origin as the BFF. This ensures that legitimate interactions between the frontend and the BFF do not require any preflights, so there's no additional overhead.<a href="#section-6.1.3.3.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="use-anti-forgerydouble-submit-cookies">
<section id="section-6.1.3.3.3">
              <h6 id="name-use-anti-forgery-double-sub">
<a href="#section-6.1.3.3.3" class="section-number selfRef">6.1.3.3.3. </a><a href="#name-use-anti-forgery-double-sub" class="section-name selfRef">Use anti-forgery/double submit cookies</a>
              </h6>
<p id="section-6.1.3.3.3-1">Some technology stacks and frameworks have built-in CRSF protection using anti-forgery cookies. This mechanism relies on a session-specific secret that is stored in a cookie, which can only be read by the legitimate frontend running in the domain associated with the cookie. The frontend is expected to read the cookie and insert its value into the request, typically by adding a custom request header. The backend verifies the value in the cookie to the value provided by the frontend to identify legitimate requests. When implemented correctly for all state changing requests, this mechanism effectively mitigates CSRF.<a href="#section-6.1.3.3.3-1" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.3-2">Note that this mechanism is not necessarily recommended over the CORS approach. However, if a framework offers built-in support for this mechanism, it can serve as a low-effort alternative to protect against CSRF.<a href="#section-6.1.3.3.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations-in-the-bff-architecture">
<section id="section-6.1.3.3.4">
              <h6 id="name-privacy-considerations-in-t">
<a href="#section-6.1.3.3.4" class="section-number selfRef">6.1.3.3.4. </a><a href="#name-privacy-considerations-in-t" class="section-name selfRef">Privacy considerations in the BFF architecture</a>
              </h6>
<p id="section-6.1.3.3.4-1">The BFF pattern requires that the JavaScript application proxies all requests to a resource server through a backend BFF component. As a consequence, the BFF component is able to observe all requests and responses between a JavaScript application and a resource server, which can have a considerable privacy impact.<a href="#section-6.1.3.3.4-1" class="pilcrow">¶</a></p>
<p id="section-6.1.3.3.4-2">When the JavaScript application and BFF are built and deployed by the same party, the privacy impact is likely minimal. However, when this pattern is implemented using a BFF component that is provided or hosted by a third-party, this privacy impact needs to be taken into account.<a href="#section-6.1.3.3.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="advanced-security">
<section id="section-6.1.3.4">
            <h5 id="name-advanced-security">
<a href="#section-6.1.3.4" class="section-number selfRef">6.1.3.4. </a><a href="#name-advanced-security" class="section-name selfRef">Advanced Security</a>
            </h5>
<p id="section-6.1.3.4-1">In the BFF pattern, all OAuth responsibilities have been moved to the BFF, a server-side component acting as a confidential client. Since server-side applications run in a more controlled environment than browser-based applications, it becomes easier to adopt advanced OAuth security practices. Examples include key-based client authentication and sender-constrained tokens.<a href="#section-6.1.3.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="threat-analysis">
<section id="section-6.1.4">
          <h4 id="name-threat-analysis">
<a href="#section-6.1.4" class="section-number selfRef">6.1.4. </a><a href="#name-threat-analysis" class="section-name selfRef">Threat Analysis</a>
          </h4>
<p id="section-6.1.4-1">This section revisits the attack scenarios and consequences from <a href="#threats" class="auto internal xref">Section 5</a>, and discusses potential additional defenses.<a href="#section-6.1.4-1" class="pilcrow">¶</a></p>
<div id="attack-scenarios-and-consequences">
<section id="section-6.1.4.1">
            <h5 id="name-attack-scenarios-and-conseq">
<a href="#section-6.1.4.1" class="section-number selfRef">6.1.4.1. </a><a href="#name-attack-scenarios-and-conseq" class="section-name selfRef">Attack Scenarios and Consequences</a>
            </h5>
<p id="section-6.1.4.1-1">If the attacker has the ability to execute malicious JavaScript code in the application's execution context, the following attack scenarios become relevant:<a href="#section-6.1.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.4.1-2.1">
                <p id="section-6.1.4.1-2.1.1">Proxying Requests via the User's Browser (<a href="#scenario-proxy" class="auto internal xref">Section 5.1.4</a>)<a href="#section-6.1.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.1.4.1-3">Note that this attack scenario results in the following consequences:<a href="#section-6.1.4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.4.1-4.1">
                <p id="section-6.1.4.1-4.1.1">Client Hijacking (<a href="#consequence-hijack" class="auto internal xref">Section 5.2.3</a>)<a href="#section-6.1.4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.1.4.1-5">Note that client hijacking is an attack scenario that is inherent to the nature of browser-based applications. As a result, nothing will be able to prevent such attacks apart from stopping the execution of malicious JavaScript code in the first place. Techniques that can help to achieve this are following secure coding guidelines, code analysis, and deploying defense-in-depth mechanisms such as Content Security Policy (<span>[<a href="#CSP3" class="cite xref">CSP3</a>]</span>).<a href="#section-6.1.4.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1.4.1-6">In this architecture, the BFF is a key component handling various security-specific responsibilities and proxy-based behavior. While it is out of scope for this document to discuss a secure implementation of proxy-based applications, it is crucial to note that security vulnerabilities in the BFF can have a significant impact on the application.<a href="#section-6.1.4.1-6" class="pilcrow">¶</a></p>
<p id="section-6.1.4.1-7">Finally, the BFF is uniquely placed to observe all traffic between the JavaScript application and the resource servers. If a high-security application would prefer to implement anomaly detection or rate limiting, such a BFF would be the ideal place to do so. Such restrictions can further help to mitigate the consequences of client hijacking.<a href="#section-6.1.4.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mitigated-attack-scenarios">
<section id="section-6.1.4.2">
            <h5 id="name-mitigated-attack-scenarios">
<a href="#section-6.1.4.2" class="section-number selfRef">6.1.4.2. </a><a href="#name-mitigated-attack-scenarios" class="section-name selfRef">Mitigated Attack Scenarios</a>
            </h5>
<p id="section-6.1.4.2-1">The other attack scenarios, listed below, are effectively mitigated by the BFF application architecture:<a href="#section-6.1.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.4.2-2.1">
                <p id="section-6.1.4.2-2.1.1">Single-Execution Token Theft (<a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a>)<a href="#section-6.1.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.4.2-2.2">
                <p id="section-6.1.4.2-2.2.1">Persistent Token Theft (<a href="#scenario-persistent-theft" class="auto internal xref">Section 5.1.2</a>)<a href="#section-6.1.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.4.2-2.3">
                <p id="section-6.1.4.2-2.3.1">Acquisition and Extraction of New Tokens (<a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>)<a href="#section-6.1.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.1.4.2-3">The BFF counters the first two attack scenarios by not exposing any tokens to the browser-based application. Even when the attacker gains full control over the JavaScript application, there are simply no tokens to be stolen.<a href="#section-6.1.4.2-3" class="pilcrow">¶</a></p>
<p id="section-6.1.4.2-4">The third scenario, where the attacker obtains a fresh set of tokens by running a silent flow, is mitigated by making the BFF a confidential client. Even when the attacker manages to obtain an authorization code, they are prevented from exchanging this code due to the lack of client credentials. Additionally, the use of PKCE prevents other attacks against the authorization code.<a href="#section-6.1.4.2-4" class="pilcrow">¶</a></p>
<p id="section-6.1.4.2-5">Since refresh and access tokens are managed by the BFF and not exposed to the browser, the following two consequences of potential attacks become irrelevant:<a href="#section-6.1.4.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1.4.2-6.1">
                <p id="section-6.1.4.2-6.1.1">Exploiting Stolen Refresh Tokens (See <a href="#consequence-rt" class="auto internal xref">Section 5.2.1</a>)<a href="#section-6.1.4.2-6.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.1.4.2-6.2">
                <p id="section-6.1.4.2-6.2.1">Exploiting Stolen Access Tokens (See <a href="#consequence-at" class="auto internal xref">Section 5.2.2</a>)<a href="#section-6.1.4.2-6.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="summary">
<section id="section-6.1.4.3">
            <h5 id="name-summary">
<a href="#section-6.1.4.3" class="section-number selfRef">6.1.4.3. </a><a href="#name-summary" class="section-name selfRef">Summary</a>
            </h5>
<p id="section-6.1.4.3-1">The architecture of a BFF is significantly more complicated than a browser-only application. It requires deploying and operating a server-side BFF component. Additionally, this pattern requires all interactions between the JavaScript application and the resource servers to be proxied by the BFF. Depending on the deployment pattern, this proxy behavior can add a significant burden on the server-side components. See <a href="#practical-deployment-scenarios" class="auto internal xref">Section 6.1.2.5</a> for additional notes if the BFF is acting as the resource server.<a href="#section-6.1.4.3-1" class="pilcrow">¶</a></p>
<p id="section-6.1.4.3-2">However, because of the nature of the BFF architecture pattern, it offers strong security guarantees. Using a BFF also ensures that the application's attack surface does not increase by using OAuth. The only viable attack pattern is hijacking the client application in the user's browser, a problem inherent to web applications.<a href="#section-6.1.4.3-2" class="pilcrow">¶</a></p>
<p id="section-6.1.4.3-3">This architecture is strongly recommended for business applications, sensitive applications, and applications that handle personal data.<a href="#section-6.1.4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="pattern-tmb">
<section id="section-6.2">
        <h3 id="name-token-mediating-backend">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-token-mediating-backend" class="section-name selfRef">Token-Mediating Backend</a>
        </h3>
<p id="section-6.2-1">This section describes the architecture of a JavaScript application that relies on a backend component to handle OAuth responsibilities for obtaining tokens as a confidential client. The backend component then provides the JavaScript application with the access token to directly interact with resource servers.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">The token-mediating backend pattern is more lightweight than the BFF pattern (See <a href="#pattern-bff" class="auto internal xref">Section 6.1</a>), since it does not require the proxying of all requests and responses between the JavaScript application and the resource server. From a security perspective, the token-mediating backend is less secure than a BFF, but still offers significant advantages over an OAuth client application running directly in the browser.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">If an attacker is able to execute malicious code within the JavaScript application, the application architecture is able to prevent the attacker from abusing refresh tokens or obtaining a fresh set of tokens. However, since the access token is directly exposed to the JavaScript application, token theft scenarios fall within the capabilities of the attacker.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<div id="application-architecture-1">
<section id="section-6.2.1">
          <h4 id="name-application-architecture-2">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-application-architecture-2" class="section-name selfRef">Application Architecture</a>
          </h4>
<span id="name-oauth-20-tmb-pattern"></span><div id="fig-bbapp-pattern-tmb">
<figure id="figure-2">
            <div id="section-6.2.1-1.1">
              <div class="alignLeft art-svg artwork" id="section-6.2.1-1.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="448" width="576" viewBox="0 0 576 448" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,368 L 8,432" fill="none" stroke="black"></path>
                  <path d="M 152,368 L 152,432" fill="none" stroke="black"></path>
                  <path d="M 184,32 L 184,112" fill="none" stroke="black"></path>
                  <path d="M 232,368 L 232,432" fill="none" stroke="black"></path>
                  <path d="M 256,144 L 256,336" fill="none" stroke="black"></path>
                  <path d="M 288,208 L 288,272" fill="none" stroke="black"></path>
                  <path d="M 312,32 L 312,112" fill="none" stroke="black"></path>
                  <path d="M 320,304 L 320,336" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 368,112" fill="none" stroke="black"></path>
                  <path d="M 368,304 L 368,336" fill="none" stroke="black"></path>
                  <path d="M 416,144 L 416,176" fill="none" stroke="black"></path>
                  <path d="M 416,304 L 416,336" fill="none" stroke="black"></path>
                  <path d="M 456,32 L 456,112" fill="none" stroke="black"></path>
                  <path d="M 464,304 L 464,336" fill="none" stroke="black"></path>
                  <path d="M 480,32 L 480,112" fill="none" stroke="black"></path>
                  <path d="M 512,208 L 512,272" fill="none" stroke="black"></path>
                  <path d="M 536,144 L 536,336" fill="none" stroke="black"></path>
                  <path d="M 568,32 L 568,112" fill="none" stroke="black"></path>
                  <path d="M 568,368 L 568,432" fill="none" stroke="black"></path>
                  <path d="M 184,32 L 312,32" fill="none" stroke="black"></path>
                  <path d="M 368,32 L 456,32" fill="none" stroke="black"></path>
                  <path d="M 480,32 L 568,32" fill="none" stroke="black"></path>
                  <path d="M 184,112 L 312,112" fill="none" stroke="black"></path>
                  <path d="M 368,112 L 456,112" fill="none" stroke="black"></path>
                  <path d="M 480,112 L 568,112" fill="none" stroke="black"></path>
                  <path d="M 288,208 L 512,208" fill="none" stroke="black"></path>
                  <path d="M 288,272 L 512,272" fill="none" stroke="black"></path>
                  <path d="M 8,368 L 152,368" fill="none" stroke="black"></path>
                  <path d="M 232,368 L 568,368" fill="none" stroke="black"></path>
                  <path d="M 168,400 L 216,400" fill="none" stroke="black"></path>
                  <path d="M 8,432 L 152,432" fill="none" stroke="black"></path>
                  <path d="M 232,432 L 568,432" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="544,336 532,330.4 532,341.6" fill="black" transform="rotate(90,536,336)"></polygon>
                  <polygon class="arrowhead" points="544,144 532,138.4 532,149.6" fill="black" transform="rotate(270,536,144)"></polygon>
                  <polygon class="arrowhead" points="472,336 460,330.4 460,341.6" fill="black" transform="rotate(90,464,336)"></polygon>
                  <polygon class="arrowhead" points="424,304 412,298.4 412,309.6" fill="black" transform="rotate(270,416,304)"></polygon>
                  <polygon class="arrowhead" points="424,176 412,170.4 412,181.6" fill="black" transform="rotate(90,416,176)"></polygon>
                  <polygon class="arrowhead" points="424,144 412,138.4 412,149.6" fill="black" transform="rotate(270,416,144)"></polygon>
                  <polygon class="arrowhead" points="376,336 364,330.4 364,341.6" fill="black" transform="rotate(90,368,336)"></polygon>
                  <polygon class="arrowhead" points="376,304 364,298.4 364,309.6" fill="black" transform="rotate(270,368,304)"></polygon>
                  <polygon class="arrowhead" points="328,336 316,330.4 316,341.6" fill="black" transform="rotate(90,320,336)"></polygon>
                  <polygon class="arrowhead" points="328,304 316,298.4 316,309.6" fill="black" transform="rotate(270,320,304)"></polygon>
                  <polygon class="arrowhead" points="264,336 252,330.4 252,341.6" fill="black" transform="rotate(90,256,336)"></polygon>
                  <polygon class="arrowhead" points="264,144 252,138.4 252,149.6" fill="black" transform="rotate(270,256,144)"></polygon>
                  <polygon class="arrowhead" points="224,400 212,394.4 212,405.6" fill="black" transform="rotate(0,216,400)"></polygon>
                  <g class="text">
                    <text x="248" y="68">Authorization</text>
                    <text x="408" y="68">Token</text>
                    <text x="524" y="68">Resource</text>
                    <text x="244" y="84">Endpoint</text>
                    <text x="412" y="84">Endpoint</text>
                    <text x="524" y="84">Server</text>
                    <text x="400" y="164">(F)</text>
                    <text x="368" y="244">Token-Mediating</text>
                    <text x="464" y="244">Backend</text>
                    <text x="552" y="244">(J)</text>
                    <text x="240" y="260">(D)</text>
                    <text x="296" y="324">(B,I)</text>
                    <text x="352" y="324">(C)</text>
                    <text x="400" y="324">(E)</text>
                    <text x="448" y="324">(G)</text>
                    <text x="192" y="388">(A,H)</text>
                    <text x="44" y="404">Static</text>
                    <text x="88" y="404">Web</text>
                    <text x="124" y="404">Host</text>
                    <text x="400" y="404">Browser</text>
                  </g>
                </svg><a href="#section-6.2.1-1.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-oauth-20-tmb-pattern" class="selfRef">OAuth 2.0 TMB Pattern</a>
            </figcaption></figure>
</div>
<p id="section-6.2.1-2">In this architecture, the JavaScript code is first loaded from a static web host into the browser (A), and the application then runs in the browser. The application checks with the token-mediating backend if there is an active session (B). If an active session is found, the application receives the corresponding access token, resumes its authenticated state, and skips forward to step J.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.2.1-3">When no active session is found, the JavaScript application triggers a navigation to the token-mediating backend (C) to initiate the Authorization Code flow with the PKCE extension (described in <a href="#pattern-tmb-flow" class="auto internal xref">Section 6.2.3.1</a>), to which the token-mediating backend responds by redirecting the browser to the authorization endpoint (D). When the user is redirected back, the browser delivers the authorization code to the token-mediating backend (E), where the token-mediating backend can then exchange it for tokens at the token endpoint (F) using its client credentials and PKCE code verifier.<a href="#section-6.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.2.1-4">The token-mediating backend associates the obtained tokens with the user's session (See <a href="#pattern-tmb-sessions" class="auto internal xref">Section 6.2.2.4</a>) and sets a cookie in the response to keep track of this session (G). This response to the browser will also trigger the reloading of the JavaScript application (H). When this application reloads, it will check with the token-mediating backend for an existing session (I), allowing the JavaScript application to resume its authenticated state and obtain the access token from the token-mediating backend.<a href="#section-6.2.1-4" class="pilcrow">¶</a></p>
<p id="section-6.2.1-5">The JavaScript application in the browser can use the access token obtained in step I to directly make requests to the resource server (J).<a href="#section-6.2.1-5" class="pilcrow">¶</a></p>
<p id="section-6.2.1-6">Note that an early draft (<span>[<a href="#tmi-bff" class="cite xref">tmi-bff</a>]</span>) already documented this concept, although the draft is is currently expired and has not been proposed for adoption to the OAuth Working Group.<a href="#section-6.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-details-1">
<section id="section-6.2.2">
          <h4 id="name-implementation-details-2">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-implementation-details-2" class="section-name selfRef">Implementation Details</a>
          </h4>
<div id="session-and-oauth-endpoints">
<section id="section-6.2.2.1">
            <h5 id="name-session-and-oauth-endpoints-2">
<a href="#section-6.2.2.1" class="section-number selfRef">6.2.2.1. </a><a href="#name-session-and-oauth-endpoints-2" class="section-name selfRef">Session and OAuth Endpoints</a>
            </h5>
<p id="section-6.2.2.1-1">Most of the endpoint implementations of the token-mediating backend are similar to those described for a BFF.<a href="#section-6.2.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.2.1-2.1">
                <p id="section-6.2.2.1-2.1.1">The "check session" endpoint (Steps B and I in the diagram above) is an API endpoint called by the browser-based application. The request will carry session information when available, allowing the backend to check for an active session. The response should indicate to the browser-based application whether the session is active. If an active session is found, the backend includes the access token in the response. Additionally, the backend can include other information, such as identity information about the authenticated user.<a href="#section-6.2.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.2.1-2.2">
                <p id="section-6.2.2.1-2.2.1">The endpoint that initializes the Authorization Code flow (step C) is identical to the endpoint described for the BFF architecture. See section <a href="#bff_endpoints" class="auto internal xref">Section 6.1.2.1</a> for more details.<a href="#section-6.2.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.2.1-2.3">
                <p id="section-6.2.2.1-2.3.1">The endpoint that receives the authorization code (step E) is identical to the endpoint described for the BFF architecture. See section <a href="#bff_endpoints" class="auto internal xref">Section 6.1.2.1</a> for more details.<a href="#section-6.2.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.2.1-2.4">
                <p id="section-6.2.2.1-2.4.1">The endpoint that supports logout is identical to the endpoint described for the BFF architecture. See section <a href="#bff_endpoints" class="auto internal xref">Section 6.1.2.1</a> for more details.<a href="#section-6.2.2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="refresh-tokens-1">
<section id="section-6.2.2.2">
            <h5 id="name-refresh-tokens-2">
<a href="#section-6.2.2.2" class="section-number selfRef">6.2.2.2. </a><a href="#name-refresh-tokens-2" class="section-name selfRef">Refresh Tokens</a>
            </h5>
<p id="section-6.2.2.2-1">When using refresh tokens, as described in Section 4.14 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>, the token-mediating backend obtains the refresh token in step F and associates it with the user's session.<a href="#section-6.2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2.2-2">If the resource server rejects the access token, the JavaScript application can contact the token-mediating backend to request a new access token. The token-mediating backend relies on the cookies associated with this request to look up the user's refresh token, and makes a token request using the refresh token. These steps are not shown in the diagram. Note that this Refresh Token request is from the backend, a confidential client, thus requires client authentication.<a href="#section-6.2.2.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2.2.2-3">When the refresh token expires, there is no way to obtain a valid access token without starting an entirely new Authorization Code grant. Therefore, it is recommended to configure the lifetime of the cookie-based session to be equal to the maximum lifetime of the refresh token if such information is known upfront. Additionally, when the token-mediating backend learns that a refresh token for an active session is no longer valid, it is recommended to invalidate the session.<a href="#section-6.2.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="access-token-scopes">
<section id="section-6.2.2.3">
            <h5 id="name-access-token-scopes">
<a href="#section-6.2.2.3" class="section-number selfRef">6.2.2.3. </a><a href="#name-access-token-scopes" class="section-name selfRef">Access Token Scopes</a>
            </h5>
<p id="section-6.2.2.3-1">Depending on the resource servers being accessed and the configuration of scopes at the authorization server, the JavaScript application may wish to request access tokens with different scope configurations. This behavior would allow the JavaScript application to follow the best practice of using minimally-scoped access tokens.<a href="#section-6.2.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2.3-2">The JavaScript application can inform the token-mediating backend of the desired scopes when it checks for the active session (Step A/I). It is up to the token-mediating backend to decide if previously obtained access tokens fall within the desired scope criteria.<a href="#section-6.2.2.3-2" class="pilcrow">¶</a></p>
<p id="section-6.2.2.3-3">It should be noted that this access token caching mechanism at the token-mediating backend can cause scope elevation risks when applied indiscriminately. If the cached access token features a superset of the scopes requested by the frontend, the token-mediating backend SHOULD NOT return it to the frontend; instead it SHOULD use the refresh token to request an access token with the smaller set of scopes from the authorization server. Note that support of such an access token downscoping mechanism is at the discretion of the authorization server.<a href="#section-6.2.2.3-3" class="pilcrow">¶</a></p>
<p id="section-6.2.2.3-4">The token-mediating backend can use a similar mechanism to downscoping when relying on <span>[<a href="#RFC8707" class="cite xref">RFC8707</a>]</span> to obtain access token for a specific resource server.<a href="#section-6.2.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-tmb-sessions">
<section id="section-6.2.2.4">
            <h5 id="name-cookie-based-session-managem">
<a href="#section-6.2.2.4" class="section-number selfRef">6.2.2.4. </a><a href="#name-cookie-based-session-managem" class="section-name selfRef">Cookie-based Session Management</a>
            </h5>
<p id="section-6.2.2.4-1">Similar to the BFF, the token-mediating backend relies on browser cookies to keep track of the user's session. The same implementation guidelines and security considerations as for a BFF apply, as discussed in <a href="#pattern-bff-sessions" class="auto internal xref">Section 6.1.2.3</a>.<a href="#section-6.2.2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="combining-oauth-and-openid-connect">
<section id="section-6.2.2.5">
            <h5 id="name-combining-oauth-and-openid-c">
<a href="#section-6.2.2.5" class="section-number selfRef">6.2.2.5. </a><a href="#name-combining-oauth-and-openid-c" class="section-name selfRef">Combining OAuth and OpenID Connect</a>
            </h5>
<p id="section-6.2.2.5-1">Similar to a BFF, the token-mediating backend can choose to combine OAuth and OpenID Connect in a single flow. See <a href="#pattern-bff-oidc" class="auto internal xref">Section 6.1.2.4</a> for more details.<a href="#section-6.2.2.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="practical-deployment-scenarios-1">
<section id="section-6.2.2.6">
            <h5 id="name-practical-deployment-scenari">
<a href="#section-6.2.2.6" class="section-number selfRef">6.2.2.6. </a><a href="#name-practical-deployment-scenari" class="section-name selfRef">Practical Deployment Scenarios</a>
            </h5>
<p id="section-6.2.2.6-1">Serving the static JavaScript code is a separate responsibility from handling interactions with the authorization server. In the diagram presented above, the token-mediating backend and static web host are shown as two separate entities. In real-world deployment scenarios, these components can be deployed as a single service (i.e., the token-mediating backend serving the static JS code), as two separate services (i.e., a CDN and a token-mediating backend), or as two components in a single service (i.e., static hosting and serverless functions on a cloud platform). These deployment differences do not affect the relationships described in this pattern, but may impact other practicalities, such as the need to properly configure CORS to enable cross-origin communication.<a href="#section-6.2.2.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations-1">
<section id="section-6.2.3">
          <h4 id="name-security-considerations-2">
<a href="#section-6.2.3" class="section-number selfRef">6.2.3. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security Considerations</a>
          </h4>
<div id="pattern-tmb-flow">
<section id="section-6.2.3.1">
            <h5 id="name-the-authorization-code-grant">
<a href="#section-6.2.3.1" class="section-number selfRef">6.2.3.1. </a><a href="#name-the-authorization-code-grant" class="section-name selfRef">The Authorization Code Grant</a>
            </h5>
<p id="section-6.2.3.1-1">The main benefit of using a token-mediating backend is the backend's ability to act as a confidential client. Therefore, the token-mediating backend MUST act as a confidential client. Furthermore, the token-mediating backend MUST use the OAuth 2.0 Authorization Code grant as described by Section 2.1.1 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> to initiate a request for an access token.<a href="#section-6.2.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-bmf-cookie-security">
<section id="section-6.2.3.2">
            <h5 id="name-cookie-security-2">
<a href="#section-6.2.3.2" class="section-number selfRef">6.2.3.2. </a><a href="#name-cookie-security-2" class="section-name selfRef">Cookie Security</a>
            </h5>
<p id="section-6.2.3.2-1">The token-mediating backend uses cookies to create a user session, which is directly associated with the user's tokens, either through server-side or client-side session state. The same cookie security guidelines as for a BFF apply, as discussed in <a href="#pattern-bff-cookie-security" class="auto internal xref">Section 6.1.3.2</a>.<a href="#section-6.2.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-bmf-csrf">
<section id="section-6.2.3.3">
            <h5 id="name-cross-site-request-forgery-p">
<a href="#section-6.2.3.3" class="section-number selfRef">6.2.3.3. </a><a href="#name-cross-site-request-forgery-p" class="section-name selfRef">Cross-Site Request Forgery Protections</a>
            </h5>
<p id="section-6.2.3.3-1">The interactions between the JavaScript application and the token-mediating backend rely on cookies for authentication and authorization. Just like a BFF, the token-mediating backend is required to account for Cross-Site Request Forgery (CSRF) attacks.<a href="#section-6.2.3.3-1" class="pilcrow">¶</a></p>
<p id="section-6.2.3.3-2"><a href="#pattern-bff-csrf" class="auto internal xref">Section 6.1.3.3</a> outlines the nuances of various mitigation strategies against CSRF attacks. Specifically for a token-mediating backend, these CSRF defenses only apply to the endpoint or endpoints where the JavaScript application can obtain its access tokens.<a href="#section-6.2.3.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="advanced-oauth-security">
<section id="section-6.2.3.4">
            <h5 id="name-advanced-oauth-security">
<a href="#section-6.2.3.4" class="section-number selfRef">6.2.3.4. </a><a href="#name-advanced-oauth-security" class="section-name selfRef">Advanced OAuth Security</a>
            </h5>
<p id="section-6.2.3.4-1">The token-mediating backend is a confidential client running as a server-side component. The token-mediating backend can adopt security best practices for confidential clients, such as key-based client authentication.<a href="#section-6.2.3.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="threat-analysis-1">
<section id="section-6.2.4">
          <h4 id="name-threat-analysis-2">
<a href="#section-6.2.4" class="section-number selfRef">6.2.4. </a><a href="#name-threat-analysis-2" class="section-name selfRef">Threat Analysis</a>
          </h4>
<p id="section-6.2.4-1">This section revisits the attack scenarios and consequences from <a href="#threats" class="auto internal xref">Section 5</a>, and discusses potential additional defenses.<a href="#section-6.2.4-1" class="pilcrow">¶</a></p>
<div id="attack-scenarios-and-consequences-1">
<section id="section-6.2.4.1">
            <h5 id="name-attack-scenarios-and-consequ">
<a href="#section-6.2.4.1" class="section-number selfRef">6.2.4.1. </a><a href="#name-attack-scenarios-and-consequ" class="section-name selfRef">Attack Scenarios and Consequences</a>
            </h5>
<p id="section-6.2.4.1-1">If the attacker has the ability to execute malicious JavaScript code in the application's execution context, the following attack scenarios become relevant:<a href="#section-6.2.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.4.1-2.1">
                <p id="section-6.2.4.1-2.1.1">Single-Execution Token Theft (<a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a>) for access tokens<a href="#section-6.2.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.4.1-2.2">
                <p id="section-6.2.4.1-2.2.1">Persistent Token Theft (<a href="#scenario-persistent-theft" class="auto internal xref">Section 5.1.2</a>) for access tokens<a href="#section-6.2.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.4.1-2.3">
                <p id="section-6.2.4.1-2.3.1">Proxying Requests via the User's Browser (<a href="#scenario-proxy" class="auto internal xref">Section 5.1.4</a>)<a href="#section-6.2.4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.2.4.1-3">Note that these attack scenarios result in the following consequences:<a href="#section-6.2.4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.4.1-4.1">
                <p id="section-6.2.4.1-4.1.1">Exploiting Stolen Access Tokens (<a href="#consequence-at" class="auto internal xref">Section 5.2.2</a>)<a href="#section-6.2.4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.4.1-4.2">
                <p id="section-6.2.4.1-4.2.1">Client Hijacking (<a href="#consequence-hijack" class="auto internal xref">Section 5.2.3</a>)<a href="#section-6.2.4.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.2.4.1-5">Exposing the access token to the JavaScript application is the core idea behind the architecture pattern of the token-mediating backend. As a result, the access token becomes vulnerable to token theft by malicious JavaScript.<a href="#section-6.2.4.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mitigated-attack-scenarios-1">
<section id="section-6.2.4.2">
            <h5 id="name-mitigated-attack-scenarios-2">
<a href="#section-6.2.4.2" class="section-number selfRef">6.2.4.2. </a><a href="#name-mitigated-attack-scenarios-2" class="section-name selfRef">Mitigated Attack Scenarios</a>
            </h5>
<p id="section-6.2.4.2-1">The other attack scenarios, listed below, are effectively mitigated by the token-mediating backend:<a href="#section-6.2.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.4.2-2.1">
                <p id="section-6.2.4.2-2.1.1">Single-Execution Token Theft (<a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a>) for refresh tokens<a href="#section-6.2.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.4.2-2.2">
                <p id="section-6.2.4.2-2.2.1">Persistent Token Theft (<a href="#scenario-persistent-theft" class="auto internal xref">Section 5.1.2</a>) for refresh tokens<a href="#section-6.2.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2.4.2-2.3">
                <p id="section-6.2.4.2-2.3.1">Acquisition and Extraction of New Tokens (<a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>)<a href="#section-6.2.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.2.4.2-3">The token-mediating backend counters the first two attack scenarios by not exposing the refresh token to the browser-based application. Even when the attacker gains full control over the JavaScript application, there are simply no refresh tokens to be stolen.<a href="#section-6.2.4.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2.4.2-4">The third scenario, where the attacker obtains a fresh set of tokens by running a silent flow, is mitigated by making the token-mediating backend a confidential client. Even when the attacker manages to obtain an authorization code, they are prevented from exchanging this code due to the lack of client credentials.  Additionally, the use of PKCE prevents other attacks against the authorization code.<a href="#section-6.2.4.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2.4.2-5">Because of the nature of the token-mediating backend, the following consequences of potential attacks become irrelevant:<a href="#section-6.2.4.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.4.2-6.1">
                <p id="section-6.2.4.2-6.1.1">Exploiting Stolen Refresh Tokens (See <a href="#consequence-rt" class="auto internal xref">Section 5.2.1</a>)<a href="#section-6.2.4.2-6.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="additional-defenses">
<section id="section-6.2.4.3">
            <h5 id="name-additional-defenses">
<a href="#section-6.2.4.3" class="section-number selfRef">6.2.4.3. </a><a href="#name-additional-defenses" class="section-name selfRef">Additional Defenses</a>
            </h5>
<p id="section-6.2.4.3-1">While this architecture inherently exposes access tokens, there are some additional defenses that can help to increase the security posture of the application.<a href="#section-6.2.4.3-1" class="pilcrow">¶</a></p>
<div id="secure-token-storage">
<section id="section-6.2.4.3.1">
              <h6 id="name-secure-token-storage">
<a href="#section-6.2.4.3.1" class="section-number selfRef">6.2.4.3.1. </a><a href="#name-secure-token-storage" class="section-name selfRef">Secure Token Storage</a>
              </h6>
<p id="section-6.2.4.3.1-1">Given the nature of the token-mediating backend pattern, there is no need for persistent token storage in the browser. When needed, the application can always use its cookie-based session to obtain an access token from the token-mediating backend. <a href="#token-storage" class="auto internal xref">Section 8</a> provides more details on the security properties of various storage mechanisms in the browser.<a href="#section-6.2.4.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.4.3.1-2">Be aware that even when the access token is stored out of reach of malicious JavaScript code, the malicious code can still mimic the legitimate application and send a request to the token-mediation backend to obtain the latest access token.<a href="#section-6.2.4.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="using-sender-constrained-tokens">
<section id="section-6.2.4.3.2">
              <h6 id="name-using-sender-constrained-to">
<a href="#section-6.2.4.3.2" class="section-number selfRef">6.2.4.3.2. </a><a href="#name-using-sender-constrained-to" class="section-name selfRef">Using Sender-Constrained Tokens</a>
              </h6>
<p id="section-6.2.4.3.2-1">Using sender-constrained access tokens is not trivial in this architecture. The token-mediating backend is responsible for exchanging an authorization code or refresh token for an access token, but the JavaScript application will use the access token. Using a mechanism such as DPoP <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span> would require splitting responsibilities over two parties, which is not a scenario defined by the specification. Use of DPoP in such a scenario is out of scope for this document.<a href="#section-6.2.4.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="summary-1">
<section id="section-6.2.4.4">
            <h5 id="name-summary-2">
<a href="#section-6.2.4.4" class="section-number selfRef">6.2.4.4. </a><a href="#name-summary-2" class="section-name selfRef">Summary</a>
            </h5>
<p id="section-6.2.4.4-1">The architecture of a token-mediating backend is more complicated than a browser-only application, but less complicated than running a proxying BFF. Similar to complexity, the security properties offered by the token-mediating backend lie somewhere between using a BFF and running a browser-only application.<a href="#section-6.2.4.4-1" class="pilcrow">¶</a></p>
<p id="section-6.2.4.4-2">A token-mediating backend addresses typical scenarios that grant the attacker long-term access on behalf of the user. However, due to the consequence of access token theft, the attacker still has the ability to gain direct access to resource servers.<a href="#section-6.2.4.4-2" class="pilcrow">¶</a></p>
<p id="section-6.2.4.4-3">When considering a token-mediating backend architecture, it is strongly recommended to evaluate if adopting a full BFF as discussed in <a href="#pattern-bff" class="auto internal xref">Section 6.1</a> is a viable alternative. Only when the use cases or system requirements would prevent the use of a proxying BFF should the token-mediating backend be considered over a full BFF.<a href="#section-6.2.4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="pattern-oauth-browser">
<section id="section-6.3">
        <h3 id="name-browser-based-oauth-20-clie">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-browser-based-oauth-20-clie" class="section-name selfRef">Browser-based OAuth 2.0 client</a>
        </h3>
<p id="section-6.3-1">This section describes the architecture of a JavaScript application that acts as the OAuth client, handling all OAuth responsibilities in the browser. As a result, the browser-based application obtains tokens from the authorization server, without the involvement of a backend component.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">If an attacker is able to execute malicious JavaScript code, this application architecture is vulnerable to all attack scenarios discussed earlier (<a href="#attackscenarios" class="auto internal xref">Section 5.1</a>). In essence, the attacker will be able to obtain access tokens and refresh tokens from the authorization server, potentially giving them long-term access to protected resources on behalf of the user.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<div id="application-architecture-2">
<section id="section-6.3.1">
          <h4 id="name-application-architecture-3">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-application-architecture-3" class="section-name selfRef">Application Architecture</a>
          </h4>
<span id="name-browser-based-oauth-20-clien"></span><div id="fig-bbapp-pattern-standalone">
<figure id="figure-3">
            <div id="section-6.3.1-1.1">
              <div class="alignLeft art-svg artwork" id="section-6.3.1-1.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="336" width="520" viewBox="0 0 520 336" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,256 L 8,320" fill="none" stroke="black"></path>
                  <path d="M 152,256 L 152,320" fill="none" stroke="black"></path>
                  <path d="M 184,32 L 184,112" fill="none" stroke="black"></path>
                  <path d="M 232,256 L 232,320" fill="none" stroke="black"></path>
                  <path d="M 240,144 L 240,224" fill="none" stroke="black"></path>
                  <path d="M 288,144 L 288,224" fill="none" stroke="black"></path>
                  <path d="M 312,32 L 312,112" fill="none" stroke="black"></path>
                  <path d="M 392,32 L 392,112" fill="none" stroke="black"></path>
                  <path d="M 432,144 L 432,224" fill="none" stroke="black"></path>
                  <path d="M 480,144 L 480,224" fill="none" stroke="black"></path>
                  <path d="M 488,256 L 488,320" fill="none" stroke="black"></path>
                  <path d="M 512,32 L 512,112" fill="none" stroke="black"></path>
                  <path d="M 184,32 L 312,32" fill="none" stroke="black"></path>
                  <path d="M 392,32 L 512,32" fill="none" stroke="black"></path>
                  <path d="M 184,112 L 312,112" fill="none" stroke="black"></path>
                  <path d="M 392,112 L 512,112" fill="none" stroke="black"></path>
                  <path d="M 8,256 L 152,256" fill="none" stroke="black"></path>
                  <path d="M 232,256 L 488,256" fill="none" stroke="black"></path>
                  <path d="M 168,288 L 216,288" fill="none" stroke="black"></path>
                  <path d="M 8,320 L 152,320" fill="none" stroke="black"></path>
                  <path d="M 232,320 L 488,320" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="488,224 476,218.4 476,229.6" fill="black" transform="rotate(90,480,224)"></polygon>
                  <polygon class="arrowhead" points="440,144 428,138.4 428,149.6" fill="black" transform="rotate(270,432,144)"></polygon>
                  <polygon class="arrowhead" points="296,224 284,218.4 284,229.6" fill="black" transform="rotate(90,288,224)"></polygon>
                  <polygon class="arrowhead" points="296,144 284,138.4 284,149.6" fill="black" transform="rotate(270,288,144)"></polygon>
                  <polygon class="arrowhead" points="248,144 236,138.4 236,149.6" fill="black" transform="rotate(270,240,144)"></polygon>
                  <polygon class="arrowhead" points="224,288 212,282.4 212,293.6" fill="black" transform="rotate(0,216,288)"></polygon>
                  <g class="text">
                    <text x="248" y="68">Authorization</text>
                    <text x="452" y="68">Resource</text>
                    <text x="244" y="84">Server</text>
                    <text x="452" y="84">Server</text>
                    <text x="256" y="180">(B)</text>
                    <text x="304" y="180">(C)</text>
                    <text x="448" y="180">(D)</text>
                    <text x="496" y="180">(E)</text>
                    <text x="192" y="276">(A)</text>
                    <text x="44" y="292">Static</text>
                    <text x="88" y="292">Web</text>
                    <text x="124" y="292">Host</text>
                    <text x="352" y="292">Browser</text>
                  </g>
                </svg><a href="#section-6.3.1-1.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-browser-based-oauth-20-clien" class="selfRef">Browser-based OAuth 2.0 Client Pattern</a>
            </figcaption></figure>
</div>
<p id="section-6.3.1-2">In this architecture, the JavaScript code is first loaded from a static web host into
the browser (A), and the application then runs in the browser. In this scenario, the browser-based application is considered a public
client, which does not possess client credentials to authenticate to the authorization server.<a href="#section-6.3.1-2" class="pilcrow">¶</a></p>
<p id="section-6.3.1-3">The application obtains an authorization code (B) by initiating the Authorization Code flow with the PKCE
extension (described in <a href="#pattern-oauth-browser-flow" class="auto internal xref">Section 6.3.2.1</a>). The application exchanges the authorization code for tokens via a JavaScript-based POST request to the token endpoint (C).<a href="#section-6.3.1-3" class="pilcrow">¶</a></p>
<p id="section-6.3.1-4">The application is then responsible for storing
the access token and optional refresh token as securely as possible using appropriate browser APIs, described in <a href="#token-storage" class="auto internal xref">Section 8</a>.<a href="#section-6.3.1-4" class="pilcrow">¶</a></p>
<p id="section-6.3.1-5">When the JavaScript application in the browser wants to make a request to the resource server,
it can interact with the resource server directly. The application includes the access token in the request (D)
and receives the resource server's response (E).<a href="#section-6.3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-details-2">
<section id="section-6.3.2">
          <h4 id="name-implementation-details-3">
<a href="#section-6.3.2" class="section-number selfRef">6.3.2. </a><a href="#name-implementation-details-3" class="section-name selfRef">Implementation Details</a>
          </h4>
<p id="section-6.3.2-1">Browser-based applications that are public clients and use the Authorization Code grant type described in
Section 4.1 of OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span> MUST also follow these additional requirements
described in this section.<a href="#section-6.3.2-1" class="pilcrow">¶</a></p>
<div id="pattern-oauth-browser-flow">
<section id="section-6.3.2.1">
            <h5 id="name-the-authorization-code-grant-2">
<a href="#section-6.3.2.1" class="section-number selfRef">6.3.2.1. </a><a href="#name-the-authorization-code-grant-2" class="section-name selfRef">The Authorization Code Grant</a>
            </h5>
<p id="section-6.3.2.1-1">Browser-based applications that are public clients MUST implement the Proof Key for Code Exchange
(PKCE <span>[<a href="#RFC7636" class="cite xref">RFC7636</a>]</span>) extension when obtaining an access token, and authorization servers MUST support and enforce
PKCE for such clients.<a href="#section-6.3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.2.1-2">The PKCE extension prevents an attack where the authorization code is intercepted
and exchanged for an access token by a malicious client, by providing the
authorization server with a way to verify the client instance that exchanges
the authorization code is the same one that initiated the flow.<a href="#section-6.3.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-oauth-browser-csrf">
<section id="section-6.3.2.2">
            <h5 id="name-cross-site-request-forgery-pr">
<a href="#section-6.3.2.2" class="section-number selfRef">6.3.2.2. </a><a href="#name-cross-site-request-forgery-pr" class="section-name selfRef">Cross-Site Request Forgery Protections</a>
            </h5>
<p id="section-6.3.2.2-1">Browser-based applications MUST prevent CSRF attacks against their redirect URI. This can be
accomplished by any of the below:<a href="#section-6.3.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3.2.2-2.1">
                <p id="section-6.3.2.2-2.1.1">using PKCE, and confirming that the authorization server supports PKCE<a href="#section-6.3.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.2-2.2">
                <p id="section-6.3.2.2-2.2.1">using and verifying unique value for the OAuth <code>state</code> parameter to carry a CSRF token<a href="#section-6.3.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.2-2.3">
                <p id="section-6.3.2.2-2.3.1">if the application is using OpenID Connect, by using and verifying the OpenID Connect <code>nonce</code> parameter as described in <span>[<a href="#OpenID" class="cite xref">OpenID</a>]</span><a href="#section-6.3.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.3.2.2-3">See Section 2.1 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> for additional details on selecting a proper CSRF defense for the Authorization Code flow.<a href="#section-6.3.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-oauth-browser-rt">
<section id="section-6.3.2.3">
            <h5 id="name-refresh-tokens-3">
<a href="#section-6.3.2.3" class="section-number selfRef">6.3.2.3. </a><a href="#name-refresh-tokens-3" class="section-name selfRef">Refresh Tokens</a>
            </h5>
<p id="section-6.3.2.3-1">For browser-based clients, the refresh token is typically a bearer token, unless the application explicitly uses DPoP <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span>. As a result, the risk of a leaked refresh token
is greater than leaked access tokens, since an attacker may be able to
continue using the stolen refresh token to obtain new access tokens potentially without being
detectable by the authorization server.<a href="#section-6.3.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3.2.3-2">Authorization servers may choose whether or not to issue refresh tokens to browser-based
applications. However, in light of the impact of third-party cookie blocking mechanisms, the use of refresh tokens has become significantly more attractive. The <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> describes some additional requirements around refresh tokens
on top of the recommendations of <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>. Applications and authorization servers
conforming to this BCP MUST also follow the recommendations in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>
around refresh tokens if refresh tokens are issued to browser-based applications.<a href="#section-6.3.2.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3.2.3-3">In particular, authorization servers:<a href="#section-6.3.2.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3.2.3-4.1">
                <p id="section-6.3.2.3-4.1.1">MUST either rotate refresh tokens on each use OR use sender-constrained refresh tokens as described in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 4.14.2<a href="#section-6.3.2.3-4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.3-4.2">
                <p id="section-6.3.2.3-4.2.1">MUST either set a maximum lifetime on refresh tokens OR expire if the refresh token has not been used within some amount of time<a href="#section-6.3.2.3-4.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.3-4.3">
                <p id="section-6.3.2.3-4.3.1">upon issuing a rotated refresh token, MUST NOT extend the lifetime of the new refresh token beyond the lifetime of the initial refresh token if the refresh token has a preestablished expiration time<a href="#section-6.3.2.3-4.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.3.2.3-5">Limiting the overall refresh token lifetime to the lifetime of the initial refresh token ensures a stolen refresh token cannot be used indefinitely.<a href="#section-6.3.2.3-5" class="pilcrow">¶</a></p>
<p id="section-6.3.2.3-6">For example:<a href="#section-6.3.2.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3.2.3-7.1">
                <p id="section-6.3.2.3-7.1.1">A user authorizes an application, issuing an access token that lasts 10 minutes, and a refresh token that lasts 8 hours<a href="#section-6.3.2.3-7.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.3-7.2">
                <p id="section-6.3.2.3-7.2.1">After 10 minutes, the initial access token expires, so the application uses the refresh token to get a new access token<a href="#section-6.3.2.3-7.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.3-7.3">
                <p id="section-6.3.2.3-7.3.1">The authorization server returns a new access token that lasts 10 minutes, and a new refresh token that lasts 7 hours and 50 minutes<a href="#section-6.3.2.3-7.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.3-7.4">
                <p id="section-6.3.2.3-7.4.1">This continues until 8 hours pass from the initial authorization<a href="#section-6.3.2.3-7.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.2.3-7.5">
                <p id="section-6.3.2.3-7.5.1">At this point, when the application attempts to use the refresh token after 8 hours, the request will fail and the application will have to re-initialize an Authorization Code flow that relies on the user's authentication or previously established session<a href="#section-6.3.2.3-7.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.3.2.3-8">Authorization servers SHOULD link the lifetime of the refresh token to the user's authenticated session with the authorization server. Doing so ensures that when a user logs out, previously issued refresh tokens to browser-based applications become invalid, mimicking a single-logout scenario. Authorization servers MAY set different policies around refresh token issuance, lifetime and expiration for browser-based applications compared to other public clients.<a href="#section-6.3.2.3-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations-2">
<section id="section-6.3.3">
          <h4 id="name-security-considerations-3">
<a href="#section-6.3.3" class="section-number selfRef">6.3.3. </a><a href="#name-security-considerations-3" class="section-name selfRef">Security Considerations</a>
          </h4>
<div id="client_authentication">
<section id="section-6.3.3.1">
            <h5 id="name-client-authentication">
<a href="#section-6.3.3.1" class="section-number selfRef">6.3.3.1. </a><a href="#name-client-authentication" class="section-name selfRef">Client Authentication</a>
            </h5>
<p id="section-6.3.3.1-1">Since a browser-based application's source code is delivered to the end-user's
browser, it is unfit to contain provisioned secrets. As a consequence, browser-based applications are typically deployed as public clients as defined by Section 2.1
of OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>.<a href="#section-6.3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.3.1-2">Secrets that are statically included as part of an app distributed to
multiple users should not be treated as confidential secrets, as one
user may inspect their copy and learn the shared secret.  For this
reason, and those stated in Section 5.3.1 of <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span>, it is NOT RECOMMENDED
for authorization servers to require client authentication of browser-based
applications using a shared secret, as this serves no value beyond
client identification which is already provided by the <code>client_id</code> parameter.<a href="#section-6.3.3.1-2" class="pilcrow">¶</a></p>
<p id="section-6.3.3.1-3">Authorization servers that still require a statically included shared
secret for SPA clients MUST treat the client as a public
client, and not accept the secret as proof of the client's identity. Without
additional measures, such clients are subject to client impersonation
(see <a href="#client_impersonation" class="auto internal xref">Section 6.3.3.2</a> below).<a href="#section-6.3.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client_impersonation">
<section id="section-6.3.3.2">
            <h5 id="name-client-impersonation">
<a href="#section-6.3.3.2" class="section-number selfRef">6.3.3.2. </a><a href="#name-client-impersonation" class="section-name selfRef">Client Impersonation</a>
            </h5>
<p id="section-6.3.3.2-1">As stated in Section 10.2 of OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>, the authorization
server SHOULD NOT process authorization requests automatically
without user consent or interaction, except when the identity of the
client can be assured.<a href="#section-6.3.3.2-1" class="pilcrow">¶</a></p>
<p id="section-6.3.3.2-2">If authorization servers restrict redirect URIs to a fixed set of absolute
HTTPS URIs, preventing the use of wildcard domains, wildcard paths, or wildcard query string components,
this exact match of registered absolute HTTPS URIs MAY be accepted by authorization servers as
proof of identity of the client for the purpose of deciding whether to automatically
process an authorization request when a previous request for the client_id
has already been approved.<a href="#section-6.3.3.2-2" class="pilcrow">¶</a></p>
<div id="auth_code_redirect">
<section id="section-6.3.3.2.1">
              <h6 id="name-authorization-code-redirect">
<a href="#section-6.3.3.2.1" class="section-number selfRef">6.3.3.2.1. </a><a href="#name-authorization-code-redirect" class="section-name selfRef">Authorization Code Redirect</a>
              </h6>
<p id="section-6.3.3.2.1-1">Clients MUST register one or more redirect URIs with the authorization server, and use only exact registered redirect URIs in the authorization request.<a href="#section-6.3.3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.3.2.1-2">Authorization servers MUST require an exact match of a registered redirect URI
as described in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 4.1.1. This helps to prevent attacks targeting the authorization code.<a href="#section-6.3.3.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="in_browser_communication_security">
<section id="section-6.3.3.3">
            <h5 id="name-security-of-in-browser-comm">
<a href="#section-6.3.3.3" class="section-number selfRef">6.3.3.3. </a><a href="#name-security-of-in-browser-comm" class="section-name selfRef">Security of In-Browser Communication Flows</a>
            </h5>
<p id="section-6.3.3.3-1">In browser-based applications, it is common to execute the OAuth flow in a secondary window, such as a popup or iframe, instead of redirecting the primary window.
In these flows, the browser-based app holds control of the primary window, for instance, to avoid page refreshes or to run frame-based flows silently.<a href="#section-6.3.3.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3.3.3-2">If the browser-based app and the authorization server are invoked in different frames, they have to use in-browser communication techniques like the postMessage API (a.k.a. <span>[<a href="#WebMessaging" class="cite xref">WebMessaging</a>]</span>) instead of top-level redirections.
To guarantee confidentiality and authenticity of messages, both the initiator origin and receiver origin of a postMessage MUST be verified using the mechanisms inherently provided by the postMessage API (Section 9.3.2 in <span>[<a href="#WebMessaging" class="cite xref">WebMessaging</a>]</span>).<a href="#section-6.3.3.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3.3.3-3">Section 4.18. of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> provides additional details about the security of in-browser communication flows and the countermeasures that browser-based applications and authorization servers MUST apply to defend against these attacks.<a href="#section-6.3.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pattern-oauth-browser-cors">
<section id="section-6.3.3.4">
            <h5 id="name-cross-origin-requests">
<a href="#section-6.3.3.4" class="section-number selfRef">6.3.3.4. </a><a href="#name-cross-origin-requests" class="section-name selfRef">Cross-Origin Requests</a>
            </h5>
<p id="section-6.3.3.4-1">In this scenario, the application sends JavaScript-based requests to the authorization server and the resource server. Given the nature of OAuth 2.0, these requests are typically cross-origin, subjecting them to browser-enforced restrictions on cross-origin communication. The authorization server and the resource server MUST send necessary CORS headers (defined in <span>[<a href="#Fetch" class="cite xref">Fetch</a>]</span>) to enable the JavaScript application to make the necessary cross-origin requests. Note that in the extraordinary scenario where the browser-based OAuth client runs in the same origin as the authorization server or resource server, a CORS policy is not needed to enable the necessary interaction.<a href="#section-6.3.3.4-1" class="pilcrow">¶</a></p>
<p id="section-6.3.3.4-2">For the authorization server, the CORS configuration is relevant for the token endpoint, where the browser-based application exchanges the authorization code for tokens. Additionally, if the authorization server provides additional endpoints to the application, such as discovery metadata URLs, JSON Web Key Sets, dynamic client registration, revocation, introspection or user info endpoints, these endpoints may also be accessed by the browser-based application. Consequentially, the authorization server is responsible for supporting CORS on these endpoints.<a href="#section-6.3.3.4-2" class="pilcrow">¶</a></p>
<p id="section-6.3.3.4-3">This specification does not include guidelines for deciding the concrete CORS policy implementation, which can consist of a wildcard origin or a more restrictive configuration. Note that CORS has two modes of operation with different security properties. The first mode applies to CORS-safelisted requests, formerly known as simple requests, where the browser sends the request and uses the CORS response headers to decide if the response can be exposed to the client-side execution context. For non-CORS-safelisted requests, such as a request with a custom request header, the browser will first check the CORS policy using a preflight. The browser will only send the actual request when the server sends their approval in the preflight response.<a href="#section-6.3.3.4-3" class="pilcrow">¶</a></p>
<p id="section-6.3.3.4-4">Note that due to the authorization server's specific configuration, it is possible that the CORS response to a preflight is different than the CORS response to the actual request. During the preflight, the authorization server can only verify the provided origin, but during an actual request, the authorization server has the full request data, such as the client ID. Consequentially, the authorization server can approve a known origin during the preflight, but reject the actual request after comparing the origin to this specific client's list of pre-registered origins.<a href="#section-6.3.3.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="threat-analysis-2">
<section id="section-6.3.4">
          <h4 id="name-threat-analysis-3">
<a href="#section-6.3.4" class="section-number selfRef">6.3.4. </a><a href="#name-threat-analysis-3" class="section-name selfRef">Threat Analysis</a>
          </h4>
<p id="section-6.3.4-1">This section revisits the attack scenarios and consequences from <a href="#threats" class="auto internal xref">Section 5</a>, and discusses potential additional defenses.<a href="#section-6.3.4-1" class="pilcrow">¶</a></p>
<div id="attack-scenarios-and-consequences-2">
<section id="section-6.3.4.1">
            <h5 id="name-attack-scenarios-and-conseque">
<a href="#section-6.3.4.1" class="section-number selfRef">6.3.4.1. </a><a href="#name-attack-scenarios-and-conseque" class="section-name selfRef">Attack Scenarios and Consequences</a>
            </h5>
<p id="section-6.3.4.1-1">If the attacker has the ability to execute malicious JavaScript code in the application's execution context, the following attack scenarios become relevant:<a href="#section-6.3.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3.4.1-2.1">
                <p id="section-6.3.4.1-2.1.1">Single-Execution Token Theft (<a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a>)<a href="#section-6.3.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.4.1-2.2">
                <p id="section-6.3.4.1-2.2.1">Persistent Token Theft (<a href="#scenario-persistent-theft" class="auto internal xref">Section 5.1.2</a>)<a href="#section-6.3.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.4.1-2.3">
                <p id="section-6.3.4.1-2.3.1">Acquisition and Extraction of New Tokens (<a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>)<a href="#section-6.3.4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.4.1-2.4">
                <p id="section-6.3.4.1-2.4.1">Proxying Requests via the User's Browser (<a href="#scenario-proxy" class="auto internal xref">Section 5.1.4</a>)<a href="#section-6.3.4.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-6.3.4.1-3">The most dangerous attack scenario is the acquisition and extraction of new tokens. In this attack scenario, the attacker only interacts with the authorization server, which makes the actual implementation details of the OAuth functionality in the JavaScript client irrelevant. Even if the legitimate client application finds a perfectly secure token storage mechanism, the attacker will still be able to obtain tokens from the authorization server.<a href="#section-6.3.4.1-3" class="pilcrow">¶</a></p>
<p id="section-6.3.4.1-4">Note that these attack scenarios result in the following consequences:<a href="#section-6.3.4.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3.4.1-5.1">
                <p id="section-6.3.4.1-5.1.1">Exploiting Stolen Refresh Tokens (See <a href="#consequence-rt" class="auto internal xref">Section 5.2.1</a>)<a href="#section-6.3.4.1-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.4.1-5.2">
                <p id="section-6.3.4.1-5.2.1">Exploiting Stolen Access Tokens (See <a href="#consequence-at" class="auto internal xref">Section 5.2.2</a>)<a href="#section-6.3.4.1-5.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.3.4.1-5.3">
                <p id="section-6.3.4.1-5.3.1">Client Hijacking (See <a href="#consequence-hijack" class="auto internal xref">Section 5.2.3</a>)<a href="#section-6.3.4.1-5.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="additional-defenses-1">
<section id="section-6.3.4.2">
            <h5 id="name-additional-defenses-2">
<a href="#section-6.3.4.2" class="section-number selfRef">6.3.4.2. </a><a href="#name-additional-defenses-2" class="section-name selfRef">Additional Defenses</a>
            </h5>
<p id="section-6.3.4.2-1">While this architecture is inherently vulnerable to malicious JavaScript code, there are some additional defenses that can help to increase the security posture of the application. Note that none of these defenses address or fix the underlying problem that allows the attacker to run a new flow to obtain tokens.<a href="#section-6.3.4.2-1" class="pilcrow">¶</a></p>
<div id="secure-token-storage-1">
<section id="section-6.3.4.2.1">
              <h6 id="name-secure-token-storage-2">
<a href="#section-6.3.4.2.1" class="section-number selfRef">6.3.4.2.1. </a><a href="#name-secure-token-storage-2" class="section-name selfRef">Secure Token Storage</a>
              </h6>
<p id="section-6.3.4.2.1-1">When handling tokens directly, the application can choose different storage mechanisms to store access tokens and refresh tokens. Universally accessible storage areas, such as <em>Local Storage</em> (<span>[<a href="#WebStorage" class="cite xref">WebStorage</a>]</span>), are easier to access from malicious JavaScript than highly isolated storage areas, such as a <em>Web Worker</em> (<span>[<a href="#WebWorker" class="cite xref">WebWorker</a>]</span>). <a href="#token-storage" class="auto internal xref">Section 8</a> discusses different storage mechanisms with their trade-off in more detail.<a href="#section-6.3.4.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.4.2.1-2">A practical implementation pattern can use a Web Worker <span>[<a href="#WebWorker" class="cite xref">WebWorker</a>]</span> to isolate the refresh token, and provide the application with the access token making requests to resource servers.<a href="#section-6.3.4.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.3.4.2.1-3">Note that even a perfect token storage mechanism does not prevent the attacker from running a new flow to obtain a fresh set of tokens (See <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>).<a href="#section-6.3.4.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="using-sender-constrained-tokens-1">
<section id="section-6.3.4.2.2">
              <h6 id="name-using-sender-constrained-tok">
<a href="#section-6.3.4.2.2" class="section-number selfRef">6.3.4.2.2. </a><a href="#name-using-sender-constrained-tok" class="section-name selfRef">Using Sender-Constrained Tokens</a>
              </h6>
<p id="section-6.3.4.2.2-1">Browser-based OAuth clients can implement DPoP <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span> to transition from bearer access tokens and bearer refresh tokens to sender-constrained tokens. In such an implementation, the private key used to sign DPoP proofs is handled by the browser (a non-extractable <a href="https://developer.mozilla.org/en-US/docs/Web/API/CryptoKeyPair">CryptoKeyPair</a> is stored using IndexedDB (<span>[<a href="#indexeddb" class="cite xref">indexeddb</a>]</span>)). As a result, the use of DPoP effectively prevents scenarios where the attacker exfiltrates the application's tokens (See <a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a> and <a href="#scenario-persistent-theft" class="auto internal xref">Section 5.1.2</a>).<a href="#section-6.3.4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.3.4.2.2-2">Note that the use of DPoP does not prevent the attacker from running a new flow to obtain a fresh set of tokens (See <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>). Even when DPoP is mandatory, the attacker can bind the fresh set of tokens to a key pair under their control, allowing them to exfiltrate the sender-constrained tokens and use them by relying on the attacker-controlled key to calculate the necessary DPoP proofs.<a href="#section-6.3.4.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="restricting-access-to-the-authorization-server">
<section id="section-6.3.4.2.3">
              <h6 id="name-restricting-access-to-the-a">
<a href="#section-6.3.4.2.3" class="section-number selfRef">6.3.4.2.3. </a><a href="#name-restricting-access-to-the-a" class="section-name selfRef">Restricting Access to the Authorization Server</a>
              </h6>
<p id="section-6.3.4.2.3-1">The scenario where the attacker obtains a fresh set of tokens (See <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>) relies on the ability to directly interact with the authorization server from within the browser. In theory, a defense that prevents the attacker from silently interacting with the authorization server could solve the most dangerous attack scenario. However, in practice, such defenses are ineffective or impractical.<a href="#section-6.3.4.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3.4.2.3-2">For completeness, this BCP lists a few options below. Note that none of these defenses are recommended, as they do not offer practically usable security benefits.<a href="#section-6.3.4.2.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3.4.2.3-3">The authorization server could block authorization requests that originate from within an iframe. While this would prevent the exact scenario from <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>, it would not work for slight variations of the attack scenario. For example, the attacker can launch the silent flow in a popup window, or a pop-under window. Additionally, browser-only OAuth clients typically rely on a hidden iframe-based flow to bootstrap the user's authentication state, so this approach would significantly impact the user experience.<a href="#section-6.3.4.2.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3.4.2.3-4">The authorization server could opt to make user consent mandatory in every Authorization Code flow (as described in Section 10.2 OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>), thus requiring user interaction before issuing an authorization code. This approach would make it harder for an attacker to run a silent flow to obtain a fresh set of tokens. However, it also significantly impacts the user experience by continuously requiring consent. As a result, this approach would result in "consent fatigue", which makes it likely that the user will blindly approve the consent, even when it is associated with a flow that was initialized by the attacker.<a href="#section-6.3.4.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="summary-2">
<section id="section-6.3.4.3">
            <h5 id="name-summary-3">
<a href="#section-6.3.4.3" class="section-number selfRef">6.3.4.3. </a><a href="#name-summary-3" class="section-name selfRef">Summary</a>
            </h5>
<p id="section-6.3.4.3-1">To summarize, the architecture of a browser-based OAuth client application is straightforward, but results in a significant increase in the attack surface of the application. The attacker is not only able to hijack the client, but also to extract a full-featured set of tokens from the browser-based application.<a href="#section-6.3.4.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3.4.3-2">This architecture is not recommended for business applications, sensitive applications, and applications that handle personal data.<a href="#section-6.3.4.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="discouraged-and-deprecated-architecture-patterns">
<section id="section-7">
      <h2 id="name-discouraged-and-deprecated-">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-discouraged-and-deprecated-" class="section-name selfRef">Discouraged and Deprecated Architecture Patterns</a>
      </h2>
<p id="section-7-1">Client applications and backend applications have evolved significantly over the last two decades, along with threats, attacker models, and a general understanding of modern application security. As a result, previous recommendations are often no longer recommended and proposed solutions often fall short of meeting the expected security requirements.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">This section discusses a few alternative architecture patterns, which are not recommended for use in modern browser-based OAuth applications. This section discusses each of the patterns, along with a threat analysis that investigates the attack scenarios and consequences when relevant.<a href="#section-7-2" class="pilcrow">¶</a></p>
<div id="single-domain-browser-based-applications-not-using-oauth">
<section id="section-7.1">
        <h3 id="name-single-domain-browser-based">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-single-domain-browser-based" class="section-name selfRef">Single-Domain Browser-Based Applications (not using OAuth)</a>
        </h3>
<p id="section-7.1-1">Too often, simple applications are made needlessly complex by using OAuth to replace the concept of session management. A typical example is the modern incarnation of a server-side MVC application, which now consists of a browser-based frontend backed by a server-side API.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">In such an application, the use of OpenID connect to offload user authentication to a dedicated provider can significantly simplify the application's architecture and development. However, the use of OAuth for governing access between the frontend and the backend is often not needed. Instead of using access tokens, the application can rely on traditional cookie-based session management to keep track of the user's authentication status. The security guidelines to protect the session cookie are discussed in <a href="#pattern-bff-cookie-security" class="auto internal xref">Section 6.1.3.2</a>.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">While the advice to not use OAuth seems out-of-place in this document, it is important to note that OAuth was originally created for third-party or federated access to APIs, so it may not be the best solution in a single common-domain deployment. That said, there are still some advantages in using OAuth even in a common-domain architecture:<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-4.1">
            <p id="section-7.1-4.1.1">Allows more flexibility in the future, such as if you were to later add a new domain to the system. With OAuth already in place, adding a new domain wouldn't require any additional rearchitecting.<a href="#section-7.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-4.2">
            <p id="section-7.1-4.2.1">Being able to take advantage of existing library support rather than writing bespoke code for the integration.<a href="#section-7.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-4.3">
            <p id="section-7.1-4.3.1">Centralizing login and multi-factor authentication support, account management, and recovery at the OAuth server, rather than making it part of the application logic.<a href="#section-7.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.1-4.4">
            <p id="section-7.1-4.4.1">Splitting of responsibilities between authenticating a user and serving resources<a href="#section-7.1-4.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-7.1-5">Using OAuth for browser-based applications in a first-party same-domain scenario provides these advantages, and can be accomplished by any of the architectural patterns described above.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<div id="threat-analysis-3">
<section id="section-7.1.1">
          <h4 id="name-threat-analysis-4">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-threat-analysis-4" class="section-name selfRef">Threat Analysis</a>
          </h4>
<p id="section-7.1.1-1">Due to the lack of using OAuth, this architecture pattern is only vulnerable to the following attack scenarios: Proxying Requests via the User's Browser (<a href="#scenario-proxy" class="auto internal xref">Section 5.1.4</a>). As a result, this pattern can lead to the following consequence: Client Hijacking (<a href="#consequence-hijack" class="auto internal xref">Section 5.2.3</a>)<a href="#section-7.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="implicit_flow">
<section id="section-7.2">
        <h3 id="name-oauth-implicit-grant">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-oauth-implicit-grant" class="section-name selfRef">OAuth Implicit Grant</a>
        </h3>
<p id="section-7.2-1">The OAuth 2.0 Implicit grant type (defined in Section 4.2 of
OAuth 2.0 <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>) works by the authorization server issuing an access token in the
authorization response (front channel) without an authorization code exchange step. In this case, the access
token is returned in the fragment part of the redirect URI, providing an attacker
with several opportunities to intercept and steal the access token.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">The security properties of the Implicit grant type make it no longer a recommended best practice. To effectively prevent the use of this flow, the authorization server MUST NOT issue access tokens in the authorization response, and MUST issue
access tokens only from the token endpoint. Browser-based clients MUST use the Authorization Code grant type and MUST NOT use the Implicit grant type to obtain access tokens.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<div id="historic-note">
<section id="section-7.2.1">
          <h4 id="name-historic-note">
<a href="#section-7.2.1" class="section-number selfRef">7.2.1. </a><a href="#name-historic-note" class="section-name selfRef">Historic Note</a>
          </h4>
<p id="section-7.2.1-1">Historically, the Implicit grant type provided an advantage to browser-based applications since
JavaScript could always arbitrarily read and manipulate the fragment portion of the
URL without triggering a page reload. This was necessary in order to remove the
access token from the URL after it was obtained by the app. Additionally, until
CORS was widespread in browsers, the Implicit grant type
offered an alternative flow that didn't require CORS support in the browser or on the server.<a href="#section-7.2.1-1" class="pilcrow">¶</a></p>
<p id="section-7.2.1-2">Modern browsers now have the Session History API (described in "Session history and
navigation" of <span>[<a href="#HTML" class="cite xref">HTML</a>]</span>), which provides a mechanism to modify the path and query string
component of the URL without triggering a page reload. Additionally, CORS has widespread
support and is often used by single-page applications for many purposes. This means modern browser-based applications can
use the OAuth 2.0 Authorization Code grant type with PKCE, since they have the ability to
remove the authorization code from the query string without triggering a page reload
thanks to the Session History API, and CORS support at the token endpoint means the
app can obtain tokens even if the authorization server is on a different domain.<a href="#section-7.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="threat-analysis-4">
<section id="section-7.2.2">
          <h4 id="name-threat-analysis-5">
<a href="#section-7.2.2" class="section-number selfRef">7.2.2. </a><a href="#name-threat-analysis-5" class="section-name selfRef">Threat Analysis</a>
          </h4>
<p id="section-7.2.2-1">The architecture pattern discussed in this section is vulnerable to the following attack scenarios:<a href="#section-7.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.2-2.1">
              <p id="section-7.2.2-2.1.1">Single-Execution Token Theft <a href="#scenario-single-theft" class="auto internal xref">Section 5.1.1</a><a href="#section-7.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-2.2">
              <p id="section-7.2.2-2.2.1">Persistent Token Theft <a href="#scenario-persistent-theft" class="auto internal xref">Section 5.1.2</a><a href="#section-7.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-2.3">
              <p id="section-7.2.2-2.3.1">Acquisition and Extraction of New Tokens <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a><a href="#section-7.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-2.4">
              <p id="section-7.2.2-2.4.1">Proxying Requests via the User's Browser <a href="#scenario-proxy" class="auto internal xref">Section 5.1.4</a><a href="#section-7.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.2.2-3">As a result, this pattern can lead to the following consequences:<a href="#section-7.2.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.2-4.1">
              <p id="section-7.2.2-4.1.1">Exploiting Stolen Refresh Tokens <a href="#consequence-rt" class="auto internal xref">Section 5.2.1</a><a href="#section-7.2.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-4.2">
              <p id="section-7.2.2-4.2.1">Exploiting Stolen Access Tokens <a href="#consequence-at" class="auto internal xref">Section 5.2.2</a><a href="#section-7.2.2-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.2-4.3">
              <p id="section-7.2.2-4.3.1">Client Hijacking <a href="#consequence-hijack" class="auto internal xref">Section 5.2.3</a><a href="#section-7.2.2-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="further-attacks-on-the-implicit-grant">
<section id="section-7.2.3">
          <h4 id="name-further-attacks-on-the-impl">
<a href="#section-7.2.3" class="section-number selfRef">7.2.3. </a><a href="#name-further-attacks-on-the-impl" class="section-name selfRef">Further Attacks on the Implicit Grant</a>
          </h4>
<p id="section-7.2.3-1">Apart from the attack scenarios and consequences that were already discussed, there are a few additional attacks that further support the deprecation of the Implicit grant type. Many attacks on the Implicit grant type described by <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span> and Section 4.1.2 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>
do not have sufficient mitigation strategies. The following sections describe the specific
attacks that cannot be mitigated while continuing to use the Implicit grant type.<a href="#section-7.2.3-1" class="pilcrow">¶</a></p>
<div id="manipulation-of-the-redirect-uri">
<section id="section-7.2.3.1">
            <h5 id="name-manipulation-of-the-redirec">
<a href="#section-7.2.3.1" class="section-number selfRef">7.2.3.1. </a><a href="#name-manipulation-of-the-redirec" class="section-name selfRef">Manipulation of the Redirect URI</a>
            </h5>
<p id="section-7.2.3.1-1">If an attacker is able to cause the authorization response to be sent to a URI under
their control, they will directly get access to the authorization response including the access token.
Several methods of performing this attack are described in detail in <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-7.2.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="access-token-leak-in-browser-history">
<section id="section-7.2.3.2">
            <h5 id="name-access-token-leak-in-browse">
<a href="#section-7.2.3.2" class="section-number selfRef">7.2.3.2. </a><a href="#name-access-token-leak-in-browse" class="section-name selfRef">Access Token Leak in Browser History</a>
            </h5>
<p id="section-7.2.3.2-1">An attacker could obtain the access token from the browser's history.
The countermeasures recommended by <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span> are limited to using short expiration
times for tokens, and indicating that browsers should not cache the response.
Neither of these fully prevent this attack, they only reduce the potential damage.<a href="#section-7.2.3.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2.3.2-2">Additionally, many browsers now also sync browser history to cloud services and to
multiple devices, providing an even wider attack surface to extract access tokens
out of the URL.<a href="#section-7.2.3.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2.3.2-3">This is discussed in more detail in Section 4.3.2 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span>.<a href="#section-7.2.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="manipulation-of-scripts">
<section id="section-7.2.3.3">
            <h5 id="name-manipulation-of-scripts">
<a href="#section-7.2.3.3" class="section-number selfRef">7.2.3.3. </a><a href="#name-manipulation-of-scripts" class="section-name selfRef">Manipulation of Scripts</a>
            </h5>
<p id="section-7.2.3.3-1">An attacker could modify the page or inject scripts into the browser through various
means, including when the browser's HTTPS connection is being intercepted by, for
example, a corporate network. While attacks on the TLS layer are typically out of scope
of basic security recommendations to prevent, in the case of browser-based applications they are
much easier to perform. An injected script can enable an attacker to have access to everything
on the page.<a href="#section-7.2.3.3-1" class="pilcrow">¶</a></p>
<p id="section-7.2.3.3-2">The risk of a malicious script running on the page may be amplified when the application
uses a known standard way of obtaining access tokens, namely that the attacker can
always look at the <code>window.location</code> variable to find an access token. This threat profile
is different from an attacker specifically targeting an individual application
by knowing where or how an access token obtained via the Authorization Code flow may
end up being stored.<a href="#section-7.2.3.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="access-token-leak-to-third-party-scripts">
<section id="section-7.2.3.4">
            <h5 id="name-access-token-leak-to-third-">
<a href="#section-7.2.3.4" class="section-number selfRef">7.2.3.4. </a><a href="#name-access-token-leak-to-third-" class="section-name selfRef">Access Token Leak to Third-Party Scripts</a>
            </h5>
<p id="section-7.2.3.4-1">It is relatively common to use third-party scripts in browser-based applications, such as
analytics tools, crash reporting, and even things like a Facebook or Twitter "like" button.
In these situations, the author of the application may not be able to be fully aware
of the entirety of the code running in the application. When an access token is
returned in the fragment, it is visible to any third-party scripts on the page.<a href="#section-7.2.3.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="disadvantages-of-the-implicit-grant">
<section id="section-7.2.4">
          <h4 id="name-disadvantages-of-the-implic">
<a href="#section-7.2.4" class="section-number selfRef">7.2.4. </a><a href="#name-disadvantages-of-the-implic" class="section-name selfRef">Disadvantages of the Implicit Grant</a>
          </h4>
<p id="section-7.2.4-1">There are several additional reasons the Implicit grant type is disadvantageous compared to
using the recommended Authorization Code grant type.<a href="#section-7.2.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2.4-2.1">
              <p id="section-7.2.4-2.1.1">OAuth 2.0 provides no mechanism for a client to verify that a particular access token was
intended for that client, which could lead to misuse and possible impersonation attacks if
a malicious party hands off an access token it retrieved through some other means
to the client.<a href="#section-7.2.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.4-2.2">
              <p id="section-7.2.4-2.2.1">Returning an access token in the front-channel redirect gives the authorization
server no assurance that the access token will actually end up at the
application, since there are many ways this redirect may fail or be intercepted.<a href="#section-7.2.4-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.4-2.3">
              <p id="section-7.2.4-2.3.1">Supporting the Implicit grant type requires additional code, more upkeep and
understanding of the related security considerations. Limiting the
authorization server to just the Authorization Code grant type reduces the attack surface
of the implementation.<a href="#section-7.2.4-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.2.4-2.4">
              <p id="section-7.2.4-2.4.1">If the JavaScript application gets wrapped into a native app, then <span>[<a href="#RFC8252" class="cite xref">RFC8252</a>]</span>
also requires the use of the Authorization Code grant type with PKCE anyway.<a href="#section-7.2.4-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.2.4-3">In OpenID Connect, the ID Token is sent in a known format (as a JWT), and digitally
signed. Returning an ID token using the Implicit grant type (<code>response_type=id_token</code>) requires the client
validate the JWT signature, as malicious parties could otherwise craft and supply
fraudulent ID tokens. Performing OpenID Connect using the Authorization Code grant type provides
the benefit of the client not needing to verify the JWT signature, as the ID token will
have been fetched over an HTTPS connection directly from the authorization server's token endpoint. Additionally,
in many cases an application will request both an ID token and an access token, so it is
simpler and provides fewer attack vectors to obtain both via the Authorization Code flow.<a href="#section-7.2.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="resource-owner-password-grant">
<section id="section-7.3">
        <h3 id="name-resource-owner-password-gra">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-resource-owner-password-gra" class="section-name selfRef">Resource Owner Password Grant</a>
        </h3>
<p id="section-7.3-1">The Resource Owner Password Credentials Grant MUST NOT be used, as described in
<span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> Section 2.4. Instead, by using the Authorization Code grant type
and redirecting the user to the authorization server,
this provides the authorization server the opportunity to prompt the user for
secure non-phishable authentication options, take advantage of single sign-on sessions,
or use third-party identity providers. In contrast, the Resource Owner Password Credentials Grant does not
provide any built-in mechanism for these, and would instead need to be extended with custom protocols.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">To conform to this best practice, browser-based applications using OAuth or OpenID
Connect MUST use a redirect-based flow (e.g. the OAuth Authorization Code grant type)
as described in this document.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="service-worker">
<section id="section-7.4">
        <h3 id="name-handling-the-oauth-flow-in-">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-handling-the-oauth-flow-in-" class="section-name selfRef">Handling the OAuth Flow in a Service Worker</a>
        </h3>
<p id="section-7.4-1">In an attempt to limit the attacker's ability to extract existing tokens or acquire a new set of tokens, a pattern using a Service Worker (<span>[<a href="#serviceworker" class="cite xref">serviceworker</a>]</span>) has been suggested in the past. In this pattern, the application's first action upon loading is registering a Service Worker. The Service Worker becomes responsible for executing the Authorization Code flow to obtain tokens and to augment outgoing requests to the resource server with the proper access token. Additionally, the Service Worker blocks the client application's code from making direct calls to the authorization server's endpoints. This restrictions aims to target the attack scenario "Acquisition and Extraction of New Tokens" (<a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>).<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">The sequence diagram included below illustrates the interactions between the client, the Service Worker, the authorization server, and the resource server.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<span id="name-oauth-20-service-worker-pat"></span><div id="fig-bbapp-pattern-serviceworker">
<figure id="figure-4">
          <div id="section-7.4-3.1">
            <div class="alignLeft art-svg artwork" id="section-7.4-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="432" width="568" viewBox="0 0 568 432" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 16,64 L 16,368" fill="none" stroke="black"></path>
                <path d="M 120,64 L 120,368" fill="none" stroke="black"></path>
                <path d="M 224,64 L 224,368" fill="none" stroke="black"></path>
                <path d="M 392,64 L 392,120" fill="none" stroke="black"></path>
                <path d="M 392,168 L 392,216" fill="none" stroke="black"></path>
                <path d="M 392,248 L 392,368" fill="none" stroke="black"></path>
                <path d="M 512,64 L 512,368" fill="none" stroke="black"></path>
                <path d="M 24,96 L 112,96" fill="none" stroke="black"></path>
                <path d="M 128,112 L 216,112" fill="none" stroke="black"></path>
                <path d="M 232,128 L 504,128" fill="none" stroke="black"></path>
                <path d="M 232,224 L 504,224" fill="none" stroke="black"></path>
                <path d="M 128,304 L 216,304" fill="none" stroke="black"></path>
                <path d="M 232,352 L 384,352" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="512,224 500,218.4 500,229.6" fill="black" transform="rotate(0,504,224)"></polygon>
                <polygon class="arrowhead" points="512,128 500,122.4 500,133.6" fill="black" transform="rotate(0,504,128)"></polygon>
                <polygon class="arrowhead" points="392,352 380,346.4 380,357.6" fill="black" transform="rotate(0,384,352)"></polygon>
                <polygon class="arrowhead" points="224,304 212,298.4 212,309.6" fill="black" transform="rotate(0,216,304)"></polygon>
                <polygon class="arrowhead" points="224,112 212,106.4 212,117.6" fill="black" transform="rotate(0,216,112)"></polygon>
                <polygon class="arrowhead" points="120,96 108,90.4 108,101.6" fill="black" transform="rotate(0,112,96)"></polygon>
                <g class="text">
                  <text x="224" y="36">Service</text>
                  <text x="388" y="36">Resource</text>
                  <text x="512" y="36">Authorization</text>
                  <text x="20" y="52">User</text>
                  <text x="128" y="52">Application</text>
                  <text x="220" y="52">Worker</text>
                  <text x="388" y="52">Server</text>
                  <text x="508" y="52">Server</text>
                  <text x="68" y="84">browse</text>
                  <text x="460" y="116">/authorize</text>
                  <text x="276" y="148">redirect</text>
                  <text x="324" y="148">w/</text>
                  <text x="392" y="148">authorization</text>
                  <text x="468" y="148">code</text>
                  <text x="232" y="164">&lt;</text>
                  <text x="248" y="164">-</text>
                  <text x="264" y="164">-</text>
                  <text x="280" y="164">-</text>
                  <text x="296" y="164">-</text>
                  <text x="312" y="164">-</text>
                  <text x="328" y="164">-</text>
                  <text x="344" y="164">-</text>
                  <text x="360" y="164">-</text>
                  <text x="376" y="164">-</text>
                  <text x="392" y="164">-</text>
                  <text x="408" y="164">-</text>
                  <text x="424" y="164">-</text>
                  <text x="440" y="164">-</text>
                  <text x="456" y="164">-</text>
                  <text x="472" y="164">-</text>
                  <text x="488" y="164">-</text>
                  <text x="504" y="164">-</text>
                  <text x="280" y="196">token</text>
                  <text x="336" y="196">request</text>
                  <text x="268" y="212">w/</text>
                  <text x="300" y="212">auth</text>
                  <text x="340" y="212">code</text>
                  <text x="476" y="212">/token</text>
                  <text x="232" y="244">&lt;</text>
                  <text x="248" y="244">-</text>
                  <text x="264" y="244">-</text>
                  <text x="280" y="244">-</text>
                  <text x="296" y="244">-</text>
                  <text x="312" y="244">-</text>
                  <text x="328" y="244">-</text>
                  <text x="344" y="244">-</text>
                  <text x="360" y="244">-</text>
                  <text x="376" y="244">-</text>
                  <text x="392" y="244">-</text>
                  <text x="408" y="244">-</text>
                  <text x="424" y="244">-</text>
                  <text x="440" y="244">-</text>
                  <text x="456" y="244">-</text>
                  <text x="472" y="244">-</text>
                  <text x="488" y="244">-</text>
                  <text x="504" y="244">-</text>
                  <text x="172" y="276">resource</text>
                  <text x="168" y="292">request</text>
                  <text x="276" y="324">resource</text>
                  <text x="344" y="324">request</text>
                  <text x="252" y="340">w/</text>
                  <text x="292" y="340">access</text>
                  <text x="344" y="340">token</text>
                  <text x="20" y="388">User</text>
                  <text x="128" y="388">Application</text>
                  <text x="224" y="388">Service</text>
                  <text x="388" y="388">Resource</text>
                  <text x="512" y="388">Authorization</text>
                  <text x="220" y="404">Worker</text>
                  <text x="388" y="404">Server</text>
                  <text x="508" y="404">Server</text>
                </g>
              </svg><a href="#section-7.4-3.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-oauth-20-service-worker-pat" class="selfRef">OAuth 2.0 Service Worker Pattern</a>
          </figcaption></figure>
</div>
<p id="section-7.4-4">Note that this pattern never exposes the tokens to the application running in the browser. Since the Service Worker runs in an isolated execution environment, there is no shared memory and no way for the client application to influence the execution of the Service Worker.<a href="#section-7.4-4" class="pilcrow">¶</a></p>
<div id="threat-analysis-5">
<section id="section-7.4.1">
          <h4 id="name-threat-analysis-6">
<a href="#section-7.4.1" class="section-number selfRef">7.4.1. </a><a href="#name-threat-analysis-6" class="section-name selfRef">Threat Analysis</a>
          </h4>
<p id="section-7.4.1-1">The architecture pattern discussed in this section is vulnerable to the following attack scenarios:<a href="#section-7.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.1-2.1">
              <p id="section-7.4.1-2.1.1">Acquisition and Extraction of New Tokens <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a><a href="#section-7.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-2.2">
              <p id="section-7.4.1-2.2.1">Proxying Requests via the User's Browser <a href="#scenario-proxy" class="auto internal xref">Section 5.1.4</a><a href="#section-7.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.4.1-3">As a result, this pattern can lead to the following consequences:<a href="#section-7.4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.1-4.1">
              <p id="section-7.4.1-4.1.1">Exploiting Stolen Refresh Tokens <a href="#consequence-rt" class="auto internal xref">Section 5.2.1</a><a href="#section-7.4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-4.2">
              <p id="section-7.4.1-4.2.1">Exploiting Stolen Access Tokens <a href="#consequence-at" class="auto internal xref">Section 5.2.2</a><a href="#section-7.4.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-4.3">
              <p id="section-7.4.1-4.3.1">Client Hijacking <a href="#consequence-hijack" class="auto internal xref">Section 5.2.3</a><a href="#section-7.4.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div id="attacking-the-service-worker">
<section id="section-7.4.1.1">
            <h5 id="name-attacking-the-service-worke">
<a href="#section-7.4.1.1" class="section-number selfRef">7.4.1.1. </a><a href="#name-attacking-the-service-worke" class="section-name selfRef">Attacking the Service Worker</a>
            </h5>
<p id="section-7.4.1.1-1">The seemingly promising security benefits of using a Service Worker warrant a more detailed discussion of its security limitations. To fully protect the application against the relevant attack scenarios (<a href="#attackscenarios" class="auto internal xref">Section 5.1</a>), the Service Worker needs to meet two security requirements:<a href="#section-7.4.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.4.1.1-2">
<li id="section-7.4.1.1-2.1">
                <p id="section-7.4.1.1-2.1.1">Prevent an attacker from exfiltrating tokens<a href="#section-7.4.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-7.4.1.1-2.2">
                <p id="section-7.4.1.1-2.2.1">Prevent an attacker from acquiring a new set of tokens<a href="#section-7.4.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            </ol>
<p id="section-7.4.1.1-3">Once registered, the Service Worker runs an Authorization Code flow and obtains the tokens. Since the Service Worker keeps track of tokens in its own isolated execution environment, they are out of reach for any application code, including potentially malicious code. Consequentially, the Service Worker meets the first requirement of preventing token exfiltration. This essentially neutralizes the first two attack scenarios discussed in <a href="#attackscenarios" class="auto internal xref">Section 5.1</a>.<a href="#section-7.4.1.1-3" class="pilcrow">¶</a></p>
<p id="section-7.4.1.1-4">To meet the second security requirement, the Service Worker must be able to guarantee that an attacker controlling the legitimate application cannot execute a new Authorization Code grant, an attack discussed in <a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>. Due to the nature of Service Workers, the registered Service Worker will be able to block all outgoing requests that initialize such a new flow, even when they occur in a frame or a new window.<a href="#section-7.4.1.1-4" class="pilcrow">¶</a></p>
<p id="section-7.4.1.1-5">However, the malicious code running inside the application can unregister this Service Worker. Unregistering a Service Worker can have a significant functional impact on the application, so it is not an operation the browser handles lightly. Therefore, an unregistered Service Worker is marked as such, but all currently running instances remain active until their corresponding browsing context is terminated (e.g., by closing the tab or window). So even when an attacker unregisters a Service Worker, it remains active and able to prevent the attacker from reaching the authorization server.<a href="#section-7.4.1.1-5" class="pilcrow">¶</a></p>
<p id="section-7.4.1.1-6">One of the consequences of unregistering a Service Worker is that it will not be present when a new browsing context is opened. So when the attacker first unregisters the Service Worker, and then starts a new flow in a frame, there will be no Service Worker associated with the browsing context of the frame. Consequentially, the attacker will be able to run an Authorization Code grant, extract the code from the frame's URL, and exchange it for tokens.<a href="#section-7.4.1.1-6" class="pilcrow">¶</a></p>
<p id="section-7.4.1.1-7">In essence, the Service Worker fails to meet the second security requirement, leaving it vulnerable to the scenario where the attacker acquires a new set of tokens (<a href="#scenario-new-flow" class="auto internal xref">Section 5.1.3</a>).<a href="#section-7.4.1.1-7" class="pilcrow">¶</a></p>
<p id="section-7.4.1.1-8">Due to these shortcomings, combined with the significant complexity of registering and maintaining a Service Worker, this pattern is not recommended.<a href="#section-7.4.1.1-8" class="pilcrow">¶</a></p>
<p id="section-7.4.1.1-9">Finally, note that the use of a Service Worker by itself does not increase the attack surface of the application. In practice, Service Workers are often used to retrofit a legacy application with support for including OAuth access tokens on outgoing requests. The Service Worker in these scenarios does not change the security properties of the application, but merely simplifies development and maintenance of the application.<a href="#section-7.4.1.1-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="token-storage">
<section id="section-8">
      <h2 id="name-token-storage-in-the-browse">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-token-storage-in-the-browse" class="section-name selfRef">Token Storage in the Browser</a>
      </h2>
<p id="section-8-1">When a browser-based application handles tokens directly, it becomes responsible for ephemerally or persistently storing tokens. As a consequence, the application needs to decide how to manage tokens (e.g., in-memory vs persistent storage), and which steps to take to further isolate tokens from the main application code. This section discusses a few different storage mechanisms and their properties.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">When discussing the security properties of browser-based token storage solutions, it is important to understand the attacker's capabilities when they compromise a browser-based application. Similar to previous discussions, there are two main attack scenarios that should be taken into account:<a href="#section-8-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-3">
<li id="section-8-3.1">
          <p id="section-8-3.1.1">The attacker obtaining tokens from storage<a href="#section-8-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-3.2">
          <p id="section-8-3.2.1">The attacker obtaining tokens from the provider (e.g., the authorization server or the token-mediating backend)<a href="#section-8-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-8-4">Since the attacker's code becomes indistinguishable from the legitimate application's code, the attacker will always be able to request tokens from the provider in exactly the same way as the legitimate application code. As a result, not even the perfect token storage solution can address the dangers of the second threat, where the attacker requests tokens from the provider.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">That said, the different security properties of browser-based storage solutions will impact the attacker's ability to obtain existing tokens from storage.<a href="#section-8-5" class="pilcrow">¶</a></p>
<div id="cookies">
<section id="section-8.1">
        <h3 id="name-cookies">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-cookies" class="section-name selfRef">Cookies</a>
        </h3>
<p id="section-8.1-1">Browser cookies are both a storage mechanism and a transport mechanism. The browser automatically supports both through the corresponding request and response headers, resulting in the storage of cookies in the browser and the automatic inclusion of cookies on outgoing requests given it matches the cookie's domain, path, or other properties.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">Next to header-based control over cookies, browsers also offer a JavaScript Cookie API to get and set cookies. This Cookie API is often mistaken as an easy way to store data in the browser. In such a scenario, the JavaScript code stores a token in a cookie, with the intent to retrieve the token for later for inclusion in the Authorization header of an API call. However, since the cookie is associated with the domain of the browser-based application, the browser will also send the cookie containing the token when making a request to the server running on this domain. One example of such a request is the browser loading the application after a previous visit to the application (step A in the diagram of <a href="#pattern-oauth-browser" class="auto internal xref">Section 6.3</a>).<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Because of these unintentional side effect of using cookies for JavaScript-based storage, this practice is NOT RECOMMENDED.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">Note that this practice is different from the use of cookies in a BFF (discussed in <a href="#pattern-bff-cookie-security" class="auto internal xref">Section 6.1.3.2</a>), where the cookie is inaccessible to JavaScript and is supposed to be sent to the backend.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-storage-service-worker">
<section id="section-8.2">
        <h3 id="name-token-storage-in-a-service-">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-token-storage-in-a-service-" class="section-name selfRef">Token Storage in a Service Worker</a>
        </h3>
<p id="section-8.2-1">A Service Worker (<span>[<a href="#serviceworker" class="cite xref">serviceworker</a>]</span>) offers a fully isolated environment to keep track of tokens. These tokens are inaccessible to the client application, effectively protecting them against exfiltration. To guarantee the security of these tokens, the Service Worker cannot share these tokens with the application. Consequentially, whenever the application wants to perform an operation with a token, it has to ask the Service Worker to perform this operation and return the result.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">When aiming to isolate tokens from the application's execution context, the Service Worker MUST NOT store tokens in any persistent storage API that is shared with the main window. For example, currently, the IndexedDB storage is shared between the browsing context and Service Worker, so is not a suitable place for the Service Worker to persist data that should remain inaccessible to the main window. Consequentially, the Service Worker currently does not have access to an isolated persistent storage area.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">As discussed before, the use of a Service Worker does not prevent an attacker from obtaining a new set of tokens. Similarly, if the application is responsible for obtaining tokens from the authorization server and passing them to a Service Worker for further management, the attacker can perform the same operation as the legitimate application to obtain these tokens.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-storage-in-a-web-worker">
<section id="section-8.3">
        <h3 id="name-token-storage-in-a-web-work">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-token-storage-in-a-web-work" class="section-name selfRef">Token Storage in a Web Worker</a>
        </h3>
<p id="section-8.3-1">The application can use a Web Worker (<span>[<a href="#WebWorker" class="cite xref">WebWorker</a>]</span>), which results in an almost identical scenario as the previous one that relies on a Service Worker. The difference between a Service Worker and a Web Worker is the level of access and its runtime properties. Service Workers can intercept and modify outgoing requests, while Web Workers are just a way to run background tasks. Web Workers are ephemeral and disappear when the browsing context is closed, while Service Workers are persistent services registered in the browser.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The security properties of using a Web Worker are identical to using Service Workers. When tokens are exposed to the application, they become vulnerable. When tokens need to be used, the operation that relies on them has to be carried out by the Web Worker.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">One common use of Web Workers is to isolate the refresh token. In such a scenario, the application runs an Authorization Code flow to obtain the authorization code. This code is forwarded to a Web Worker, which exchanges it for tokens. The Web Worker keeps the refresh token in memory and sends the access token to the main application. The main application uses the access token as desired. When the application needs to run a refresh token flow, it asks the Web Worker to do so, after which the application obtains a fresh access token.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<p id="section-8.3-4">In this scenario, the application's existing refresh token is effectively protected against exfiltration, but the access token is not. Additionally, nothing would prevent an attacker from obtaining their own tokens by running a new Authorization Code flow.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-storage-in-memory">
<section id="section-8.4">
        <h3 id="name-in-memory-token-storage">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-in-memory-token-storage" class="section-name selfRef">In-Memory Token Storage</a>
        </h3>
<p id="section-8.4-1">Another option is keeping tokens in-memory, without using any persistent storage. Doing so limits the exposure of the tokens to the current execution context only, but has the downside of not being able to persist tokens between page loads.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">In a JavaScript execution environment, the security of in-memory token storage can be further enhanced by using a closure variable to effectively shield the token from direct access. By using closures, the token is only accessible to the pre-defined functions inside the closure, such as a function to make a request to the resource server.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<p id="section-8.4-3">While closures work well in simple, isolated environments, they are tricky to secure in a complex environment like the browser's execution environment. For example, a closure relies on a variety of outside functions to execute its operations, such as <em>toString</em> functions or networking APIs. Using prototype poisoning, an attacker can substitute these functions with malicious versions, causing the closure's future operations to use these malicious versions. Inside the malicious function, the attacker can gain access to the function arguments, which may expose the tokens from within the closure to the attacker.<a href="#section-8.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-storage-persistent">
<section id="section-8.5">
        <h3 id="name-persistent-token-storage">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-persistent-token-storage" class="section-name selfRef">Persistent Token Storage</a>
        </h3>
<p id="section-8.5-1">The persistent storage APIs currently available as of this writing are localStorage (<span>[<a href="#WebStorage" class="cite xref">WebStorage</a>]</span>), sessionStorage (<span>[<a href="#WebStorage" class="cite xref">WebStorage</a>]</span>), and IndexedDB (<span>[<a href="#indexeddb" class="cite xref">indexeddb</a>]</span>).<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<p id="section-8.5-2">localStorage persists between page reloads as well as is shared across all tabs. This storage is accessible to the entire origin, and persists longer term. localStorage does not protect against XSS attacks, as the attacker would be running code within the same origin, and as such, would be able to read the contents of the localStorage.<a href="#section-8.5-2" class="pilcrow">¶</a></p>
<p id="section-8.5-3">sessionStorage is similar to localStorage, except that the lifetime of sessionStorage is linked to the lifetime of a browser tab. Additionally, sessionStorage is not shared between multiple tabs open to pages on the same origin, which slightly reduces the exposure of the tokens in sessionStorage.<a href="#section-8.5-3" class="pilcrow">¶</a></p>
<p id="section-8.5-4">IndexedDB is a persistent storage mechanism like localStorage, but is shared between multiple tabs as well as between the browsing context and Service Workers.<a href="#section-8.5-4" class="pilcrow">¶</a></p>
<p id="section-8.5-5">Note that the main difference between these patterns is the exposure of the data, but that none of these options can fully mitigate token exfiltration when the attacker can execute malicious code in the application's execution environment.<a href="#section-8.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="filesystem-considerations">
<section id="section-8.6">
        <h3 id="name-filesystem-considerations-f">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-filesystem-considerations-f" class="section-name selfRef">Filesystem Considerations for Browser Storage APIs</a>
        </h3>
<p id="section-8.6-1">In all cases, as of this writing, browsers ultimately store data in plain text on the filesystem. This behavior exposes tokens to attackers with the ability to read files on disk. While such attacks rely on capabilities that are well beyond the scope of browser-based applications, this topic highlights an important attack vector against modern applications. More and more malware is specifically created to crawl user's machines looking for browser profiles to obtain high-value tokens and sessions, resulting in account takeover attacks.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">While the browser-based application is incapable of mitigating such attacks, the application can mitigate the consequences of such an attack by ensuring data confidentiality using encryption. The <span>[<a href="#WebCryptographyAPI" class="cite xref">WebCryptographyAPI</a>]</span> provides a mechanism for JavaScript code to generate a secret key, as well as an option for that key to be non-exportable. A JavaScript application could then use this API to encrypt and decrypt tokens before storing them. However, the <span>[<a href="#WebCryptographyAPI" class="cite xref">WebCryptographyAPI</a>]</span> specification only ensures that the key is not exportable to the browser code, but does not place any requirements on the underlying storage of the key itself with the operating system. As such, a non-exportable key cannot be relied on as a way to protect against exfiltration from the underlying filesystem.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
<p id="section-8.6-3">In order to protect against token exfiltration from the filesystem, the encryption keys would need to be stored somewhere other than the filesystem, such as on a remote server. This introduces new complexity for a purely browser-based app, and is out of scope of this document.<a href="#section-8.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations-3">
<section id="section-9">
      <h2 id="name-security-considerations-4">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations-4" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="reducing-the-authority-of-tokens">
<section id="section-9.1">
        <h3 id="name-reducing-the-authority-of-t">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-reducing-the-authority-of-t" class="section-name selfRef">Reducing the Authority of Tokens</a>
        </h3>
<p id="section-9.1-1">A general security best practice in the OAuth world is to minimize the authority associated with access tokens. This best practice is applicable to all the architectures discussed in this specification. Concretely, the following considerations can be helpful in reducing the authority of access tokens:<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-2.1">
            <p id="section-9.1-2.1.1">Reduce the lifetime of access tokens and rely on refresh tokens for access token renewal<a href="#section-9.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.2">
            <p id="section-9.1-2.2.1">Reduce the scopes or permissions associated with the access token<a href="#section-9.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-2.3">
            <p id="section-9.1-2.3.1">Use <span>[<a href="#RFC8707" class="cite xref">RFC8707</a>]</span> to restrict access tokens to a single resource<a href="#section-9.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.1-3">When OpenID Connect is used, it is important to avoid sensitive information disclosure through the claims in the ID Token. The authorization server SHOULD NOT include any ID token claims that aren't used by the client.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sender-constrained-tokens">
<section id="section-9.2">
        <h3 id="name-sender-constrained-tokens">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-sender-constrained-tokens" class="section-name selfRef">Sender-Constrained Tokens</a>
        </h3>
<p id="section-9.2-1">As discussed throughout this document, the use of sender-constrained tokens does not solve the security limitations of browser-only OAuth clients. However, when the level of security offered by a token-mediating backend (<a href="#pattern-tmb" class="auto internal xref">Section 6.2</a>) or a browser-only OAuth client (<a href="#pattern-oauth-browser" class="auto internal xref">Section 6.3</a>) suffices for the use case at hand, sender-constrained tokens can be used to enhance the security of both access tokens and refresh tokens. One method of implementing sender-constrained tokens in a way that is usable from browser-based applications is DPoP <span>[<a href="#RFC9449" class="cite xref">RFC9449</a>]</span>.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">When using sender-constrained tokens, the OAuth client has to prove possession of a private key in order to use the token, such that the token isn't usable by itself. If a sender-constrained token is stolen, the attacker wouldn't be able to use the token directly, they would need to also steal the private key. In essence, one could say that using sender-constrained tokens shifts the challenge of securely storing the token to securely storing the private key. Ideally the application should use a non-exportable private key, such as generating one with the <span>[<a href="#WebCryptographyAPI" class="cite xref">WebCryptographyAPI</a>]</span>. With an unencrypted token in localStorage protected by a non-exportable private key, an XSS attack would not be able to extract the key, so the token would not be usable by the attacker.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2-3">If the application is unable to use an API that generates a non-exportable key, the application should take measures to isolate the private key from its own execution context. The techniques for doing so are similar to using a secure token storage mechanism, as discussed in <a href="#token-storage" class="auto internal xref">Section 8</a>.<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<p id="section-9.2-4">While a non-exportable key is protected from exfiltration from within JavaScript, exfiltration of the underlying private key from the filesystem is still a concern. As of the time of this writing, there is no guarantee made by the <span>[<a href="#WebCryptographyAPI" class="cite xref">WebCryptographyAPI</a>]</span> that a non-exportable key is actually protected by a Trusted Platform Module (TPM) or stored in an encrypted form on disk. Exfiltration of the non-exportable key from the underlying filesystem may still be possible if the attacker can get access to the filesystem of the user's machine, for example via malware.<a href="#section-9.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth_server_mixup">
<section id="section-9.3">
        <h3 id="name-authorization-server-mix-up">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-authorization-server-mix-up" class="section-name selfRef">Authorization Server Mix-Up Mitigation</a>
        </h3>
<p id="section-9.3-1">Authorization server mix-up attacks mark a severe threat to every client that supports
at least two authorization servers. Section 4.4 of <span>[<a href="#oauth-security-topics" class="cite xref">oauth-security-topics</a>]</span> provides additional details about mix-up attacks
and the countermeasures mentioned above.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="isolating-applications-using-origins">
<section id="section-9.4">
        <h3 id="name-isolating-applications-usin">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-isolating-applications-usin" class="section-name selfRef">Isolating Applications using Origins</a>
        </h3>
<p id="section-9.4-1">Many of the web's security mechanisms rely on origins, which are defined as the triple <code>&lt;scheme, hostname, port&gt;</code>. For example, browsers automatically isolate browsing contexts with different origins, limit resources to certain origins, and apply CORS restrictions to outgoing cross-origin requests.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">Therefore, it is considered a best practice to avoid deploying more than one application in a single origin. An architecture that only deploys a single application in an origin can leverage these browser restrictions to increase the security of the application. Additionally, having a single origin per application makes it easier to configure and deploy security measures such as CORS, CSP, etc.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">This document does not require any IANA actions.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="CookiePrefixes">[CookiePrefixes]</dt>
        <dd>
<span class="refAuthor">Contributors, M.</span>, <span class="refTitle">"Using HTTP cookies"</span>, <span>n.d.</span>, <span>&lt;<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="draft-ietf-httpbis-rfc6265bis">[draft-ietf-httpbis-rfc6265bis]</dt>
        <dd>
<span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Englehardt, S.</span>, <span class="refAuthor">West, M.</span>, and <span class="refAuthor">J. Wilander</span>, <span class="refTitle">"Cookies: HTTP State Management Mechanism"</span>, <time datetime="2021-10" class="refDate">October 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis">https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Fetch">[Fetch]</dt>
        <dd>
<span class="refAuthor">whatwg</span>, <span class="refTitle">"Fetch"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="oauth-security-topics">[oauth-security-topics]</dt>
        <dd>
<span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Labunets, A.</span>, and <span class="refAuthor">D. Fett</span>, <span class="refTitle">"OAuth 2.0 Security Best Current Practice"</span>, <time datetime="2021-04" class="refDate">April 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6750">[RFC6750]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span> and <span class="refAuthor">D. Hardt</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework: Bearer Token Usage"</span>, <span class="seriesInfo">RFC 6750</span>, <span class="seriesInfo">DOI 10.17487/RFC6750</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6750">https://www.rfc-editor.org/info/rfc6750</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6819">[RFC6819]</dt>
        <dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span>, <span class="refAuthor">McGloin, M.</span>, and <span class="refAuthor">P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Threat Model and Security Considerations"</span>, <span class="seriesInfo">RFC 6819</span>, <span class="seriesInfo">DOI 10.17487/RFC6819</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6819">https://www.rfc-editor.org/info/rfc6819</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7636">[RFC7636]</dt>
        <dd>
<span class="refAuthor">Sakimura, N., Ed.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">N. Agarwal</span>, <span class="refTitle">"Proof Key for Code Exchange by OAuth Public Clients"</span>, <span class="seriesInfo">RFC 7636</span>, <span class="seriesInfo">DOI 10.17487/RFC7636</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7636">https://www.rfc-editor.org/info/rfc7636</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8252">[RFC8252]</dt>
        <dd>
<span class="refAuthor">Denniss, W.</span> and <span class="refAuthor">J. Bradley</span>, <span class="refTitle">"OAuth 2.0 for Native Apps"</span>, <span class="seriesInfo">BCP 212</span>, <span class="seriesInfo">RFC 8252</span>, <span class="seriesInfo">DOI 10.17487/RFC8252</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8252">https://www.rfc-editor.org/info/rfc8252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9207">[RFC9207]</dt>
      <dd>
<span class="refAuthor">Meyer zu Selhausen, K.</span> and <span class="refAuthor">D. Fett</span>, <span class="refTitle">"OAuth 2.0 Authorization Server Issuer Identification"</span>, <span class="seriesInfo">RFC 9207</span>, <span class="seriesInfo">DOI 10.17487/RFC9207</span>, <time datetime="2022-03" class="refDate">March 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9207">https://www.rfc-editor.org/info/rfc9207</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="CSP3">[CSP3]</dt>
        <dd>
<span class="refAuthor">West, M.</span>, <span class="refTitle">"Content Security Policy"</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTML">[HTML]</dt>
        <dd>
<span class="refAuthor">whatwg</span>, <span class="refTitle">"HTML"</span>, <time datetime="2020" class="refDate">2020</time>, <span>&lt;<a href="https://html.spec.whatwg.org/">https://html.spec.whatwg.org/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="indexeddb">[indexeddb]</dt>
        <dd>
<span class="refAuthor">Bell, J.</span>, <span class="refTitle">"Indexed Database API 3.0"</span>, <span>n.d.</span>, <span>&lt;<a href="https://www.w3.org/TR/IndexedDB/">https://www.w3.org/TR/IndexedDB/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OpenID">[OpenID]</dt>
        <dd>
<span class="refAuthor">Sakimura, N.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Jones, M.</span>, <span class="refAuthor">de Medeiros, B.</span>, and <span class="refAuthor">C. Mortimore</span>, <span class="refTitle">"OpenID Connect"</span>, <time datetime="2014-11" class="refDate">November 2014</time>, <span>&lt;<a href="https://openid.net/specs/openid-connect-core-1_0.html">https://openid.net/specs/openid-connect-core-1_0.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8707">[RFC8707]</dt>
        <dd>
<span class="refAuthor">Campbell, B.</span>, <span class="refAuthor">Bradley, J.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Resource Indicators for OAuth 2.0"</span>, <span class="seriesInfo">RFC 8707</span>, <span class="seriesInfo">DOI 10.17487/RFC8707</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8707">https://www.rfc-editor.org/info/rfc8707</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9449">[RFC9449]</dt>
        <dd>
<span class="refAuthor">Fett, D.</span>, <span class="refAuthor">Campbell, B.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Jones, M.</span>, and <span class="refAuthor">D. Waite</span>, <span class="refTitle">"OAuth 2.0 Demonstrating Proof of Possession (DPoP)"</span>, <span class="seriesInfo">RFC 9449</span>, <span class="seriesInfo">DOI 10.17487/RFC9449</span>, <time datetime="2023-09" class="refDate">September 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9449">https://www.rfc-editor.org/info/rfc9449</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="serviceworker">[serviceworker]</dt>
        <dd>
<span class="refAuthor">Archibald, J.</span> and <span class="refAuthor">M. Kruisselbrink</span>, <span class="refTitle">"Service Workers"</span>, <span>n.d.</span>, <span>&lt;<a href="https://www.w3.org/TR/service-workers/">https://www.w3.org/TR/service-workers/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Site">[Site]</dt>
        <dd>
<span class="refAuthor">Contributors, M.</span>, <span class="refTitle">"Site"</span>, <span>n.d.</span>, <span>&lt;<a href="https://developer.mozilla.org/en-US/docs/Glossary/Site">https://developer.mozilla.org/en-US/docs/Glossary/Site</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="tmi-bff">[tmi-bff]</dt>
        <dd>
<span class="refAuthor">Bertocci, V.</span> and <span class="refAuthor">B. Campbell</span>, <span class="refTitle">"Token Mediating and session Information Backend For Frontend"</span>, <time datetime="2021-04" class="refDate">April 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-bertocci-oauth2-tmi-bff-01">https://datatracker.ietf.org/doc/html/draft-bertocci-oauth2-tmi-bff-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WebCryptographyAPI">[WebCryptographyAPI]</dt>
        <dd>
<span class="refAuthor">Huigens, D.</span>, <span class="refTitle">"Web Cryptography API"</span>, <time datetime="2022-11" class="refDate">November 2022</time>, <span>&lt;<a href="https://w3c.github.io/webcrypto/">https://w3c.github.io/webcrypto/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WebMessaging">[WebMessaging]</dt>
        <dd>
<span class="refAuthor">whatwg</span>, <span class="refTitle">"HTML Living Standard - Cross-document messaging"</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://html.spec.whatwg.org/multipage/web-messaging.html#web-messaging">https://html.spec.whatwg.org/multipage/web-messaging.html#web-messaging</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WebStorage">[WebStorage]</dt>
        <dd>
<span class="refAuthor">whatwg</span>, <span class="refTitle">"HTML Living Standard - Web Storage"</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://html.spec.whatwg.org/multipage/webstorage.html#webstorage">https://html.spec.whatwg.org/multipage/webstorage.html#webstorage</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WebWorker">[WebWorker]</dt>
      <dd>
<span class="refAuthor">whatwg</span>, <span class="refTitle">"HTML Living Standard - Web workers"</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://html.spec.whatwg.org/multipage/workers.html">https://html.spec.whatwg.org/multipage/workers.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="document-history">
<section id="appendix-A">
      <h2 id="name-document-history">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-document-history" class="section-name selfRef">Document History</a>
      </h2>
<p id="appendix-A-1">[[ To be removed from the final specification ]]<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">-18<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-3.1">
          <p id="appendix-A-3.1.1">Addressed last call comments from Justin Richer<a href="#appendix-A-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-3.2">
          <p id="appendix-A-3.2.1">Updated description of the benfits of Token-Mediating Backend pattern<a href="#appendix-A-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-3.3">
          <p id="appendix-A-3.3.1">Added SVG diagrams in HTML version<a href="#appendix-A-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-3.4">
          <p id="appendix-A-3.4.1">Added privacy considerations for BFF pattern<a href="#appendix-A-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-3.5">
          <p id="appendix-A-3.5.1">Consistent use of "grant type", "grant" and "flow"<a href="#appendix-A-3.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-4">-17<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-5.1">
          <p id="appendix-A-5.1.1">Added a section on anti-forgery/double-submit cookies as another form of CSRF protection<a href="#appendix-A-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-5.2">
          <p id="appendix-A-5.2.1">Updated CORS terminology<a href="#appendix-A-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-5.3">
          <p id="appendix-A-5.3.1">Moved new section on in-browser flows as not applicable to BFF or TM patterns<a href="#appendix-A-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-5.4">
          <p id="appendix-A-5.4.1">Fixed usage of some browser technology terminology<a href="#appendix-A-5.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-5.5">
          <p id="appendix-A-5.5.1">Editorial improvements<a href="#appendix-A-5.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-6">-16<a href="#appendix-A-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-7.1">
          <p id="appendix-A-7.1.1">Applied editorial changes from Filip Skokan and Louis Jannett<a href="#appendix-A-7.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-7.2">
          <p id="appendix-A-7.2.1">Clarified when cookie encryption applies<a href="#appendix-A-7.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-7.3">
          <p id="appendix-A-7.3.1">Added a section with security considerations on the use of postMessage<a href="#appendix-A-7.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-8">-15<a href="#appendix-A-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-9.1">
          <p id="appendix-A-9.1.1">Consolidated guidelines for public JS clients in a single section<a href="#appendix-A-9.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-9.2">
          <p id="appendix-A-9.2.1">Added more focus on best practices at the start of the document<a href="#appendix-A-9.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-9.3">
          <p id="appendix-A-9.3.1">Restructured document to have top-level recommended and discouraged architecture patterns<a href="#appendix-A-9.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-9.4">
          <p id="appendix-A-9.4.1">Added Philippe De Ryck as an author<a href="#appendix-A-9.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-10">-14<a href="#appendix-A-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-11.1">
          <p id="appendix-A-11.1.1">Minor editorial fixes and clarifications<a href="#appendix-A-11.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-11.2">
          <p id="appendix-A-11.2.1">Updated some references<a href="#appendix-A-11.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-11.3">
          <p id="appendix-A-11.3.1">Added a paragraph noting the possible exfiltration of a non-exportable key from the filesystem<a href="#appendix-A-11.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-12">-13<a href="#appendix-A-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-13.1">
          <p id="appendix-A-13.1.1">Corrected some uses of "DOM"<a href="#appendix-A-13.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-13.2">
          <p id="appendix-A-13.2.1">Consolidated CSRF recommendations into normative part of the document<a href="#appendix-A-13.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-13.3">
          <p id="appendix-A-13.3.1">Added links from the summary into the later sections<a href="#appendix-A-13.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-13.4">
          <p id="appendix-A-13.4.1">Described limitations of Service Worker storage<a href="#appendix-A-13.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-13.5">
          <p id="appendix-A-13.5.1">Minor editorial improvements<a href="#appendix-A-13.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-14">-12<a href="#appendix-A-14" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-15.1">
          <p id="appendix-A-15.1.1">Revised overview and server support checklist to bring them up to date with the rest of the draft<a href="#appendix-A-15.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-15.2">
          <p id="appendix-A-15.2.1">Added a new section about options for storing tokens<a href="#appendix-A-15.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-15.3">
          <p id="appendix-A-15.3.1">Added a section on sender-constrained tokens and a reference to DPoP<a href="#appendix-A-15.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-15.4">
          <p id="appendix-A-15.4.1">Rephrased the architecture patterns to focus on token acquisition<a href="#appendix-A-15.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-15.5">
          <p id="appendix-A-15.5.1">Added a section discussing why not to use the Cookie API to store tokens<a href="#appendix-A-15.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-16">-11<a href="#appendix-A-16" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-17.1">
          <p id="appendix-A-17.1.1">Added a new architecture pattern: Token-Mediating Backend<a href="#appendix-A-17.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-17.2">
          <p id="appendix-A-17.2.1">Revised and added clarifications for the Service Worker pattern<a href="#appendix-A-17.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-17.3">
          <p id="appendix-A-17.3.1">Editorial improvements in descriptions of the different architectures<a href="#appendix-A-17.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-17.4">
          <p id="appendix-A-17.4.1">Rephrased headers<a href="#appendix-A-17.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-18">-10<a href="#appendix-A-18" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-19.1">
          <p id="appendix-A-19.1.1">Revised the names of the architectural patterns<a href="#appendix-A-19.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-19.2">
          <p id="appendix-A-19.2.1">Added a new pattern using a service worker as the OAuth client to manage tokens<a href="#appendix-A-19.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-19.3">
          <p id="appendix-A-19.3.1">Added some considerations when storing tokens in Local or Session Storage<a href="#appendix-A-19.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-20">-09<a href="#appendix-A-20" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-21.1">
          <p id="appendix-A-21.1.1">Provide additional context for the same-domain architecture pattern<a href="#appendix-A-21.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-21.2">
          <p id="appendix-A-21.2.1">Added reference to draft-ietf-httpbis-rfc6265bis to clarify that SameSite is not the only CSRF protection measure needed<a href="#appendix-A-21.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-21.3">
          <p id="appendix-A-21.3.1">Editorial improvements<a href="#appendix-A-21.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-22">-08<a href="#appendix-A-22" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-23.1">
          <p id="appendix-A-23.1.1">Added a note to use the "Secure" cookie attribute in addition to SameSite etc<a href="#appendix-A-23.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-23.2">
          <p id="appendix-A-23.2.1">Updates to bring this draft in sync with the latest Security BCP<a href="#appendix-A-23.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-23.3">
          <p id="appendix-A-23.3.1">Updated text for mix-up countermeasures to reference the new "iss" extension<a href="#appendix-A-23.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-23.4">
          <p id="appendix-A-23.4.1">Changed "SHOULD" for refresh token rotation to MUST either use rotation or sender-constraining to match the Security BCP<a href="#appendix-A-23.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-23.5">
          <p id="appendix-A-23.5.1">Fixed references to other specs and extensions<a href="#appendix-A-23.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-23.6">
          <p id="appendix-A-23.6.1">Editorial improvements in descriptions of the different architectures<a href="#appendix-A-23.6.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-24">-07<a href="#appendix-A-24" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-25.1">
          <p id="appendix-A-25.1.1">Clarify PKCE requirements apply only to issuing access tokens<a href="#appendix-A-25.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-25.2">
          <p id="appendix-A-25.2.1">Change "MUST" to "SHOULD" for refresh token rotation<a href="#appendix-A-25.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-25.3">
          <p id="appendix-A-25.3.1">Editorial clarifications<a href="#appendix-A-25.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-26">-06<a href="#appendix-A-26" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-27.1">
          <p id="appendix-A-27.1.1">Added refresh token requirements to AS summary<a href="#appendix-A-27.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-27.2">
          <p id="appendix-A-27.2.1">Editorial clarifications<a href="#appendix-A-27.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-28">-05<a href="#appendix-A-28" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-29.1">
          <p id="appendix-A-29.1.1">Incorporated editorial and substantive feedback from Mike Jones<a href="#appendix-A-29.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-29.2">
          <p id="appendix-A-29.2.1">Added references to "nonce" as another way to prevent CSRF attacks<a href="#appendix-A-29.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-29.3">
          <p id="appendix-A-29.3.1">Updated headers in the Implicit grant type section to better represent the relationship between the paragraphs<a href="#appendix-A-29.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-30">-04<a href="#appendix-A-30" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-31.1">
          <p id="appendix-A-31.1.1">Disallow the use of the Password Grant<a href="#appendix-A-31.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-31.2">
          <p id="appendix-A-31.2.1">Add PKCE support to summary list for authorization server requirements<a href="#appendix-A-31.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-31.3">
          <p id="appendix-A-31.3.1">Rewrote refresh token section to allow refresh tokens if they are time-limited, rotated on each use, and requiring that the rotated refresh token lifetimes do not extend past the lifetime of the initial refresh token, and to bring it in line with the Security BCP<a href="#appendix-A-31.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-31.4">
          <p id="appendix-A-31.4.1">Updated recommendations on using state to reflect the Security BCP<a href="#appendix-A-31.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-31.5">
          <p id="appendix-A-31.5.1">Updated server support checklist to reflect latest changes<a href="#appendix-A-31.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-31.6">
          <p id="appendix-A-31.6.1">Updated the same-domain JS architecture section to emphasize the architecture rather than domain<a href="#appendix-A-31.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-31.7">
          <p id="appendix-A-31.7.1">Editorial clarifications in the section that talks about OpenID Connect ID tokens<a href="#appendix-A-31.7.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-32">-03<a href="#appendix-A-32" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-33.1">
          <p id="appendix-A-33.1.1">Updated the historic note about the fragment URL clarifying that the Session History API means browsers can use the unmodified Authorization Code grant type<a href="#appendix-A-33.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.2">
          <p id="appendix-A-33.2.1">Rephrased "Authorization Code grant type" intro paragraph to better lead into the next two sections<a href="#appendix-A-33.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.3">
          <p id="appendix-A-33.3.1">Softened "is likely a better decision to avoid using OAuth entirely" to "it may be..." for common-domain deployments<a href="#appendix-A-33.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.4">
          <p id="appendix-A-33.4.1">Updated abstract to not be limited to public clients, since the later sections talk about confidential clients<a href="#appendix-A-33.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.5">
          <p id="appendix-A-33.5.1">Removed references to avoiding OpenID Connect for same-domain architectures<a href="#appendix-A-33.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.6">
          <p id="appendix-A-33.6.1">Updated headers to better describe architectures (Applications Served from a Static Web Server -&gt; JavaScript Applications without a Backend)<a href="#appendix-A-33.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.7">
          <p id="appendix-A-33.7.1">Expanded "same-domain architecture" section to better explain the problems that OAuth has in this scenario<a href="#appendix-A-33.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.8">
          <p id="appendix-A-33.8.1">Referenced Security BCP in Implicit grant type attacks where possible<a href="#appendix-A-33.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-33.9">
          <p id="appendix-A-33.9.1">Minor typo corrections<a href="#appendix-A-33.9.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-34">-02<a href="#appendix-A-34" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-35.1">
          <p id="appendix-A-35.1.1">Rewrote overview section incorporating feedback from Leo Tohill<a href="#appendix-A-35.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-35.2">
          <p id="appendix-A-35.2.1">Updated summary recommendation bullet points to split out application and server requirements<a href="#appendix-A-35.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-35.3">
          <p id="appendix-A-35.3.1">Removed the allowance on hostname-only redirect URI matching, now requiring exact redirect URI matching<a href="#appendix-A-35.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-35.4">
          <p id="appendix-A-35.4.1">Updated Section 6.2 to drop reference of SPA with a backend component being a public client<a href="#appendix-A-35.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-35.5">
          <p id="appendix-A-35.5.1">Expanded the architecture section to explicitly mention three architectural patterns available to JS applications<a href="#appendix-A-35.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-A-36">-01<a href="#appendix-A-36" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-37.1">
          <p id="appendix-A-37.1.1">Incorporated feedback from Torsten Lodderstedt<a href="#appendix-A-37.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-37.2">
          <p id="appendix-A-37.2.1">Updated abstract<a href="#appendix-A-37.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-37.3">
          <p id="appendix-A-37.3.1">Clarified the definition of browser-based applications to not exclude applications cached in the browser, e.g. via Service Workers<a href="#appendix-A-37.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-37.4">
          <p id="appendix-A-37.4.1">Clarified use of the state parameter for CSRF protection<a href="#appendix-A-37.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-37.5">
          <p id="appendix-A-37.5.1">Added background information about the original reason the Implicit grant type was created due to lack of CORS support<a href="#appendix-A-37.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-37.6">
          <p id="appendix-A-37.6.1">Clarified the same-domain use case where the SPA and API share a cookie domain<a href="#appendix-A-37.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-A-37.7">
          <p id="appendix-A-37.7.1">Moved historic note about the fragment URL into the Overview<a href="#appendix-A-37.7.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-B">
      <h2 id="name-acknowledgements">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-B-1">The authors would like to acknowledge the work of William Denniss and John Bradley,
whose recommendation for native applications informed many of the best practices for
browser-based applications. The authors would also like to thank Hannes Tschofenig
and Torsten Lodderstedt, the attendees of the Internet Identity Workshop 27
session at which this BCP was originally proposed, and the following individuals
who contributed ideas, feedback, and wording that shaped and formed the final specification:<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">Andy Barlow, Annabelle Backman, Brian Campbell, Brock Allen, Christian Mainka, Damien Bowden,
Daniel Fett, Elar Lang, Emmanuel Gautier, Eva Sarafianou,
Filip Skokan, George Fletcher, Hannes Tschofenig, Janak Amarasena, John Bradley, Joseph Heenan,
Justin Richer, Karl McGuinness, Karsten Meyer zu Selhausen, Leo Tohill, Louis Jannett, Mike Jones,
Sean Kelleher, Thomas Broyer, Tomek Stojecki, Torsten Lodderstedt, Vittorio Bertocci,
William Duncan, and Yannick Majoros.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Aaron Parecki</span></div>
<div dir="auto" class="left"><span class="org">Okta</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:aaron@parecki.com" class="email">aaron@parecki.com</a>
</div>
<div class="url">
<span>URI:</span>
<a href="https://aaronparecki.com" class="url">https://aaronparecki.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">David Waite</span></div>
<div dir="auto" class="left"><span class="org">Ping Identity</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:david@alkaline-solutions.com" class="email">david@alkaline-solutions.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Philippe De Ryck</span></div>
<div dir="auto" class="left"><span class="org">Pragmatic Web Security</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:philippe@pragmaticwebsecurity.com" class="email">philippe@pragmaticwebsecurity.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
